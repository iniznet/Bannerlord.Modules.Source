using System;
using System.Collections.Generic;
using StoryMode.Quests.QuestTasks;
using StoryMode.StoryModePhases;
using TaleWorlds.CampaignSystem;
using TaleWorlds.Localization;
using TaleWorlds.SaveSystem;

namespace StoryMode.Quests.TutorialPhase
{
	public class PurchaseGrainTutorialQuest : StoryModeQuestBase
	{
		private TextObject _buyItemTaskStartLog
		{
			get
			{
				TextObject textObject = new TextObject("{=D9RoNGJg}Buy 2 {GRAIN}{.s}. Click \"Buy Products\" option on village menu to buy products.", null);
				textObject.SetTextVariable("GRAIN", DefaultItems.Grain.Name);
				return textObject;
			}
		}

		public override TextObject Title
		{
			get
			{
				TextObject textObject = new TextObject("{=JhEzD45J}Purchase {GRAIN}", null);
				textObject.SetTextVariable("GRAIN", DefaultItems.Grain.Name);
				return textObject;
			}
		}

		public PurchaseGrainTutorialQuest(Hero questGiver)
			: base("purchase_grain_tutorial_quest", questGiver, CampaignTime.Never)
		{
			TutorialPhase.Instance.InitializeTutorialVillageItemRoster();
			this.SetDialogs();
			TextObject textObject = new TextObject("{=TLRyyRaW}Purchased {GRAIN} Amount", null);
			textObject.SetTextVariable("GRAIN", DefaultItems.Grain.Name);
			this._purchaseItemTutorialQuestTask = new PurchaseItemTutorialQuestTask(new Action(this.PurchaseItemTaskOnSuccess), 2, DefaultItems.Grain, base.AddDiscreteLog(this._buyItemTaskStartLog, textObject, 0, 2, null, false));
			base.AddTask(this._purchaseItemTutorialQuestTask);
		}

		protected override void SetDialogs()
		{
		}

		protected override void InitializeQuestOnGameLoad()
		{
			this.SetDialogs();
			this._purchaseItemTutorialQuestTask.AddTaskBehaviorsOnGameLoad(new Action(this.PurchaseItemTaskOnSuccess), null, null);
			this._purchaseItemTutorialQuestTask.InitializeTaskOnLoad(2, DefaultItems.Grain);
		}

		protected override void HourlyTick()
		{
		}

		private void PurchaseItemTaskOnSuccess()
		{
			base.CompleteQuestWithSuccess();
		}

		internal static void AutoGeneratedStaticCollectObjectsPurchaseGrainTutorialQuest(object o, List<object> collectedObjects)
		{
			((PurchaseGrainTutorialQuest)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			base.AutoGeneratedInstanceCollectObjects(collectedObjects);
			collectedObjects.Add(this._purchaseItemTutorialQuestTask);
		}

		internal static object AutoGeneratedGetMemberValue_purchaseItemTutorialQuestTask(object o)
		{
			return ((PurchaseGrainTutorialQuest)o)._purchaseItemTutorialQuestTask;
		}

		public const int BuyGrainAmount = 2;

		[SaveableField(1)]
		private readonly PurchaseItemTutorialQuestTask _purchaseItemTutorialQuestTask;
	}
}
