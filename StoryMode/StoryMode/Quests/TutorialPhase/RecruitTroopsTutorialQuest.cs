using System;
using System.Collections.Generic;
using StoryMode.Quests.QuestTasks;
using TaleWorlds.CampaignSystem;
using TaleWorlds.CampaignSystem.Settlements;
using TaleWorlds.Localization;
using TaleWorlds.SaveSystem;

namespace StoryMode.Quests.TutorialPhase
{
	public class RecruitTroopsTutorialQuest : StoryModeQuestBase
	{
		private TextObject _recruitTroopTaskStartLog
		{
			get
			{
				return new TextObject("{=vCBuF6dq}Recruit 4 recruits. Click \"Recruit Troops\" option on village menu to recruit troops.", null);
			}
		}

		public override TextObject Title
		{
			get
			{
				return new TextObject("{=y3fn2vWY}Recruit Troops", null);
			}
		}

		public RecruitTroopsTutorialQuest(Hero questGiver)
			: base("recruit_troops_tutorial_quest", questGiver, CampaignTime.Never)
		{
			this.SetDialogs();
			this._recruitTroopTutorialQuestTask = new RecruitTroopTutorialQuestTask(new Action(this.RecruitTaskOnSuccess), 4, new Func<CharacterObject, bool>(this.DoesRecruitedTroopSatifyRecruitTroopTask), Settlement.CurrentSettlement, base.AddDiscreteLog(this._recruitTroopTaskStartLog, new TextObject("{=y3fn2vWY}Recruit Troops", null), 0, 4, null, false));
			base.AddTask(this._recruitTroopTutorialQuestTask);
		}

		protected override void SetDialogs()
		{
		}

		protected override void InitializeQuestOnGameLoad()
		{
			this.SetDialogs();
			this._recruitTroopTutorialQuestTask.AddTaskBehaviorsOnGameLoad(new Action(this.RecruitTaskOnSuccess), null, null);
			this._recruitTroopTutorialQuestTask.InitializeTaskOnLoad(4, new Func<CharacterObject, bool>(this.DoesRecruitedTroopSatifyRecruitTroopTask), Settlement.Find("village_ES3_2"));
		}

		protected override void HourlyTick()
		{
		}

		private bool DoesRecruitedTroopSatifyRecruitTroopTask(CharacterObject troop)
		{
			return true;
		}

		private void RecruitTaskOnSuccess()
		{
			base.CompleteQuestWithSuccess();
		}

		internal static void AutoGeneratedStaticCollectObjectsRecruitTroopsTutorialQuest(object o, List<object> collectedObjects)
		{
			((RecruitTroopsTutorialQuest)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			base.AutoGeneratedInstanceCollectObjects(collectedObjects);
			collectedObjects.Add(this._recruitTroopTutorialQuestTask);
		}

		internal static object AutoGeneratedGetMemberValue_recruitTroopTutorialQuestTask(object o)
		{
			return ((RecruitTroopsTutorialQuest)o)._recruitTroopTutorialQuestTask;
		}

		public const int RecruitTroopAmount = 4;

		[SaveableField(1)]
		private readonly RecruitTroopTutorialQuestTask _recruitTroopTutorialQuestTask;
	}
}
