using System;
using System.Collections.Generic;
using TaleWorlds.CampaignSystem;
using TaleWorlds.CampaignSystem.Party;
using TaleWorlds.CampaignSystem.SceneInformationPopupTypes;
using TaleWorlds.Core;
using TaleWorlds.SaveSystem;

namespace StoryMode.StoryModePhases
{
	// Token: 0x02000019 RID: 25
	public class FirstPhase
	{
		// Token: 0x060000D3 RID: 211 RVA: 0x0000564B File Offset: 0x0000384B
		internal static void AutoGeneratedStaticCollectObjectsFirstPhase(object o, List<object> collectedObjects)
		{
			((FirstPhase)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		// Token: 0x060000D4 RID: 212 RVA: 0x00005659 File Offset: 0x00003859
		protected virtual void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			CampaignTime.AutoGeneratedStaticCollectObjectsCampaignTime(this.FirstPhaseStartTime, collectedObjects);
		}

		// Token: 0x060000D5 RID: 213 RVA: 0x0000566C File Offset: 0x0000386C
		internal static object AutoGeneratedGetMemberValueCollectedBannerPieceCount(object o)
		{
			return ((FirstPhase)o).CollectedBannerPieceCount;
		}

		// Token: 0x060000D6 RID: 214 RVA: 0x0000567E File Offset: 0x0000387E
		internal static object AutoGeneratedGetMemberValueFirstPhaseStartTime(object o)
		{
			return ((FirstPhase)o).FirstPhaseStartTime;
		}

		// Token: 0x1700003E RID: 62
		// (get) Token: 0x060000D7 RID: 215 RVA: 0x00005690 File Offset: 0x00003890
		public static FirstPhase Instance
		{
			get
			{
				return StoryModeManager.Current.MainStoryLine.FirstPhase;
			}
		}

		// Token: 0x1700003F RID: 63
		// (get) Token: 0x060000D8 RID: 216 RVA: 0x000056A1 File Offset: 0x000038A1
		// (set) Token: 0x060000D9 RID: 217 RVA: 0x000056A9 File Offset: 0x000038A9
		[SaveableProperty(1)]
		public int CollectedBannerPieceCount { get; private set; }

		// Token: 0x17000040 RID: 64
		// (get) Token: 0x060000DA RID: 218 RVA: 0x000056B2 File Offset: 0x000038B2
		// (set) Token: 0x060000DB RID: 219 RVA: 0x000056BA File Offset: 0x000038BA
		[SaveableProperty(2)]
		public CampaignTime FirstPhaseStartTime { get; private set; }

		// Token: 0x17000041 RID: 65
		// (get) Token: 0x060000DC RID: 220 RVA: 0x000056C3 File Offset: 0x000038C3
		public CampaignTime FirstPhaseEndTime
		{
			get
			{
				return CampaignTime.Years(20f) + this.FirstPhaseStartTime;
			}
		}

		// Token: 0x17000042 RID: 66
		// (get) Token: 0x060000DD RID: 221 RVA: 0x000056DA File Offset: 0x000038DA
		public bool AllPiecesCollected
		{
			get
			{
				return this.CollectedBannerPieceCount == 3;
			}
		}

		// Token: 0x060000DE RID: 222 RVA: 0x000056E5 File Offset: 0x000038E5
		public FirstPhase()
		{
			this.CollectedBannerPieceCount = 0;
			this.FirstPhaseStartTime = CampaignTime.Now;
		}

		// Token: 0x060000DF RID: 223 RVA: 0x00005700 File Offset: 0x00003900
		public void CollectBannerPiece()
		{
			int collectedBannerPieceCount = this.CollectedBannerPieceCount;
			this.CollectedBannerPieceCount = collectedBannerPieceCount + 1;
			ItemObject itemObject = null;
			if (this.CollectedBannerPieceCount == 1)
			{
				itemObject = Campaign.Current.ObjectManager.GetObject<ItemObject>("dragon_banner_center");
			}
			else if (this.CollectedBannerPieceCount == 2)
			{
				itemObject = Campaign.Current.ObjectManager.GetObject<ItemObject>("dragon_banner_dragonhead");
				MBInformationManager.ShowSceneNotification(new FindingSecondBannerPieceSceneNotificationItem(Hero.MainHero));
			}
			else if (this.CollectedBannerPieceCount == 3)
			{
				itemObject = Campaign.Current.ObjectManager.GetObject<ItemObject>("dragon_banner_handle");
				MBInformationManager.ShowSceneNotification(new FindingThirdBannerPieceSceneNotificationItem());
			}
			if (itemObject != null)
			{
				MobileParty.MainParty.ItemRoster.AddToCounts(new EquipmentElement(itemObject, null, null, true), 1);
			}
			StoryModeEvents.Instance.OnBannerPieceCollected();
		}

		// Token: 0x060000E0 RID: 224 RVA: 0x000057C0 File Offset: 0x000039C0
		public void MergeDragonBanner()
		{
			MobileParty.MainParty.ItemRoster.AddToCounts(new EquipmentElement(Campaign.Current.ObjectManager.GetObject<ItemObject>("dragon_banner_center"), null, null, true), -1);
			MobileParty.MainParty.ItemRoster.AddToCounts(new EquipmentElement(Campaign.Current.ObjectManager.GetObject<ItemObject>("dragon_banner_dragonhead"), null, null, true), -1);
			MobileParty.MainParty.ItemRoster.AddToCounts(new EquipmentElement(Campaign.Current.ObjectManager.GetObject<ItemObject>("dragon_banner_handle"), null, null, true), -1);
			MobileParty.MainParty.ItemRoster.AddToCounts(new EquipmentElement(Campaign.Current.ObjectManager.GetObject<ItemObject>("dragon_banner"), null, null, true), 1);
		}

		// Token: 0x04000053 RID: 83
		public const int NeededBannerPieceCount = 3;

		// Token: 0x04000054 RID: 84
		public const int FirstPhaseDurationAsYears = 20;

		// Token: 0x04000055 RID: 85
		public const string FirstBannerPieceStringId = "dragon_banner_center";

		// Token: 0x04000056 RID: 86
		public const string SecondBannerPieceStringId = "dragon_banner_dragonhead";

		// Token: 0x04000057 RID: 87
		public const string ThirdBannerPieceStringId = "dragon_banner_handle";
	}
}
