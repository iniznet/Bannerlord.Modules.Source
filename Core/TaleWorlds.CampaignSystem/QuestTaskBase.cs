using System;
using System.Collections.Generic;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem
{
	// Token: 0x02000065 RID: 101
	public class QuestTaskBase
	{
		// Token: 0x06000D99 RID: 3481 RVA: 0x000418E8 File Offset: 0x0003FAE8
		internal static void AutoGeneratedStaticCollectObjectsQuestTaskBase(object o, List<object> collectedObjects)
		{
			((QuestTaskBase)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		// Token: 0x06000D9A RID: 3482 RVA: 0x000418F6 File Offset: 0x0003FAF6
		protected virtual void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
		}

		// Token: 0x06000D9B RID: 3483 RVA: 0x000418F8 File Offset: 0x0003FAF8
		internal static object AutoGeneratedGetMemberValueIsLogged(object o)
		{
			return ((QuestTaskBase)o).IsLogged;
		}

		// Token: 0x06000D9C RID: 3484 RVA: 0x0004190A File Offset: 0x0003FB0A
		internal static object AutoGeneratedGetMemberValueIsActive(object o)
		{
			return ((QuestTaskBase)o).IsActive;
		}

		// Token: 0x17000350 RID: 848
		// (get) Token: 0x06000D9D RID: 3485 RVA: 0x0004191C File Offset: 0x0003FB1C
		// (set) Token: 0x06000D9E RID: 3486 RVA: 0x00041924 File Offset: 0x0003FB24
		[SaveableProperty(1)]
		public bool IsLogged { get; set; }

		// Token: 0x17000351 RID: 849
		// (get) Token: 0x06000D9F RID: 3487 RVA: 0x0004192D File Offset: 0x0003FB2D
		// (set) Token: 0x06000DA0 RID: 3488 RVA: 0x00041935 File Offset: 0x0003FB35
		[SaveableProperty(2)]
		public bool IsActive { get; private set; }

		// Token: 0x06000DA1 RID: 3489 RVA: 0x00041940 File Offset: 0x0003FB40
		public QuestTaskBase(DialogFlow dialogFlow = null, Action onSucceedAction = null, Action onFailedAction = null, Action onCanceledAction = null)
		{
			this.IsLogged = true;
			this.IsActive = true;
			this._onSucceededAction = onSucceedAction;
			this._onFailedAction = onFailedAction;
			this._onCanceledAction = onCanceledAction;
			this._dialogFlow = dialogFlow;
			if (this._dialogFlow != null)
			{
				Campaign.Current.ConversationManager.AddDialogFlow(this._dialogFlow, this);
			}
		}

		// Token: 0x06000DA2 RID: 3490 RVA: 0x0004199C File Offset: 0x0003FB9C
		public void Finish(QuestTaskBase.FinishStates finishState)
		{
			this.IsActive = false;
			if (this._dialogFlow != null)
			{
				Campaign.Current.ConversationManager.RemoveRelatedLines(this);
				this._dialogFlow = null;
			}
			switch (finishState)
			{
			case QuestTaskBase.FinishStates.Success:
				if (this._onSucceededAction != null)
				{
					this._onSucceededAction();
				}
				break;
			case QuestTaskBase.FinishStates.Fail:
				if (this._onFailedAction != null)
				{
					this._onFailedAction();
				}
				break;
			case QuestTaskBase.FinishStates.Cancel:
				if (this._onCanceledAction != null)
				{
					this._onCanceledAction();
				}
				break;
			}
			this._onSucceededAction = null;
			this._onFailedAction = null;
			this._onCanceledAction = null;
			CampaignEventDispatcher.Instance.RemoveListeners(this);
			this.OnFinished();
		}

		// Token: 0x06000DA3 RID: 3491 RVA: 0x00041A46 File Offset: 0x0003FC46
		public void AddTaskDialogs()
		{
			if (this._dialogFlow != null)
			{
				Campaign.Current.ConversationManager.AddDialogFlow(this._dialogFlow, this);
			}
		}

		// Token: 0x06000DA4 RID: 3492 RVA: 0x00041A66 File Offset: 0x0003FC66
		protected virtual void OnFinished()
		{
		}

		// Token: 0x06000DA5 RID: 3493 RVA: 0x00041A68 File Offset: 0x0003FC68
		public virtual void SetReferences()
		{
		}

		// Token: 0x06000DA6 RID: 3494 RVA: 0x00041A6A File Offset: 0x0003FC6A
		public void AddTaskDialogOnGameLoaded(DialogFlow dialogFlow)
		{
			if (this.IsActive)
			{
				this._dialogFlow = dialogFlow;
			}
		}

		// Token: 0x06000DA7 RID: 3495 RVA: 0x00041A7B File Offset: 0x0003FC7B
		public void AddTaskBehaviorsOnGameLoad(Action onSucceededAction = null, Action onFailedAction = null, Action onCanceledAction = null)
		{
			this._onSucceededAction = onSucceededAction;
			this._onFailedAction = onFailedAction;
			this._onCanceledAction = onCanceledAction;
		}

		// Token: 0x040003F6 RID: 1014
		protected Dictionary<EventDelegateType, TriggerDelegateType> EvenTriggerDelegates;

		// Token: 0x040003F9 RID: 1017
		private DialogFlow _dialogFlow;

		// Token: 0x040003FA RID: 1018
		private Action _onSucceededAction;

		// Token: 0x040003FB RID: 1019
		private Action _onFailedAction;

		// Token: 0x040003FC RID: 1020
		private Action _onCanceledAction;

		// Token: 0x020004B9 RID: 1209
		public enum FinishStates
		{
			// Token: 0x0400146E RID: 5230
			Success,
			// Token: 0x0400146F RID: 5231
			Fail,
			// Token: 0x04001470 RID: 5232
			Cancel
		}
	}
}
