using System;
using System.Collections.Generic;
using TaleWorlds.CampaignSystem.Party;
using TaleWorlds.CampaignSystem.Settlements;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.Siege
{
	// Token: 0x02000286 RID: 646
	public class SiegeEventManager
	{
		// Token: 0x06002205 RID: 8709 RVA: 0x00090D49 File Offset: 0x0008EF49
		internal static void AutoGeneratedStaticCollectObjectsSiegeEventManager(object o, List<object> collectedObjects)
		{
			((SiegeEventManager)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		// Token: 0x06002206 RID: 8710 RVA: 0x00090D57 File Offset: 0x0008EF57
		protected virtual void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			collectedObjects.Add(this._siegeEvents);
		}

		// Token: 0x06002207 RID: 8711 RVA: 0x00090D65 File Offset: 0x0008EF65
		internal static object AutoGeneratedGetMemberValue_siegeEvents(object o)
		{
			return ((SiegeEventManager)o)._siegeEvents;
		}

		// Token: 0x06002208 RID: 8712 RVA: 0x00090D72 File Offset: 0x0008EF72
		public SiegeEventManager()
		{
			this._siegeEvents = new List<SiegeEvent>();
		}

		// Token: 0x06002209 RID: 8713 RVA: 0x00090D88 File Offset: 0x0008EF88
		public SiegeEvent StartSiegeEvent(Settlement settlement, MobileParty besiegerParty)
		{
			SiegeEvent siegeEvent = new SiegeEvent(settlement, besiegerParty);
			this._siegeEvents.Add(siegeEvent);
			settlement.Party.Visuals.SetMapIconAsDirty();
			return siegeEvent;
		}

		// Token: 0x0600220A RID: 8714 RVA: 0x00090DBC File Offset: 0x0008EFBC
		public void Tick(float dt)
		{
			for (int i = 0; i < this._siegeEvents.Count; i++)
			{
				if (this._siegeEvents[i].SiegeEventVisual != null)
				{
					this._siegeEvents[i].SiegeEventVisual.Tick();
				}
				if (this._siegeEvents[i].ReadyToBeRemoved)
				{
					this._siegeEvents[i] = this._siegeEvents[this._siegeEvents.Count - 1];
					this._siegeEvents.RemoveAt(this._siegeEvents.Count - 1);
					i--;
				}
				else
				{
					this._siegeEvents[i].Tick(dt);
				}
			}
		}

		// Token: 0x04000A8F RID: 2703
		[SaveableField(1)]
		private List<SiegeEvent> _siegeEvents;
	}
}
