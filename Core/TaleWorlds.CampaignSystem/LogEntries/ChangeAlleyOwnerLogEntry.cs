using System;
using System.Collections.Generic;
using Helpers;
using TaleWorlds.CampaignSystem.Settlements;
using TaleWorlds.Core;
using TaleWorlds.Localization;
using TaleWorlds.ObjectSystem;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.LogEntries
{
	// Token: 0x020002CE RID: 718
	public class ChangeAlleyOwnerLogEntry : LogEntry, IEncyclopediaLog, IChatNotification
	{
		// Token: 0x060029D0 RID: 10704 RVA: 0x000B2716 File Offset: 0x000B0916
		internal static void AutoGeneratedStaticCollectObjectsChangeAlleyOwnerLogEntry(object o, List<object> collectedObjects)
		{
			((ChangeAlleyOwnerLogEntry)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		// Token: 0x060029D1 RID: 10705 RVA: 0x000B2724 File Offset: 0x000B0924
		protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			base.AutoGeneratedInstanceCollectObjects(collectedObjects);
			collectedObjects.Add(this.Alley);
			collectedObjects.Add(this.NewOwner);
		}

		// Token: 0x060029D2 RID: 10706 RVA: 0x000B2745 File Offset: 0x000B0945
		internal static object AutoGeneratedGetMemberValueAlley(object o)
		{
			return ((ChangeAlleyOwnerLogEntry)o).Alley;
		}

		// Token: 0x060029D3 RID: 10707 RVA: 0x000B2752 File Offset: 0x000B0952
		internal static object AutoGeneratedGetMemberValueNewOwner(object o)
		{
			return ((ChangeAlleyOwnerLogEntry)o).NewOwner;
		}

		// Token: 0x17000A4F RID: 2639
		// (get) Token: 0x060029D4 RID: 10708 RVA: 0x000B275F File Offset: 0x000B095F
		public bool IsVisibleNotification
		{
			get
			{
				return this.NewOwner != null && this.NewOwner == Hero.MainHero;
			}
		}

		// Token: 0x060029D5 RID: 10709 RVA: 0x000B2778 File Offset: 0x000B0978
		public ChangeAlleyOwnerLogEntry(Alley alley, Hero newOwner, Hero oldOwner)
		{
			this.Alley = alley;
			this.NewOwner = newOwner;
		}

		// Token: 0x060029D6 RID: 10710 RVA: 0x000B278E File Offset: 0x000B098E
		public TextObject GetNotificationText()
		{
			return this.GetEncyclopediaText();
		}

		// Token: 0x060029D7 RID: 10711 RVA: 0x000B2796 File Offset: 0x000B0996
		public override void GetConversationScoreAndComment(Hero talkTroop, bool findString, out string comment, out ImportanceEnum score)
		{
			score = ImportanceEnum.Zero;
			comment = "";
		}

		// Token: 0x060029D8 RID: 10712 RVA: 0x000B27A3 File Offset: 0x000B09A3
		public bool IsVisibleInEncyclopediaPageOf<T>(T obj) where T : MBObjectBase
		{
			return obj == this.Alley.Settlement || obj == this.NewOwner;
		}

		// Token: 0x060029D9 RID: 10713 RVA: 0x000B27C8 File Offset: 0x000B09C8
		public TextObject GetEncyclopediaText()
		{
			TextObject textObject;
			if (this.NewOwner != null)
			{
				textObject = GameTexts.FindText("str_alley_owner_changed_news", null);
				StringHelpers.SetCharacterProperties("HERO", this.NewOwner.CharacterObject, textObject, false);
			}
			else
			{
				textObject = GameTexts.FindText("str_alley_cleared_news", null);
			}
			textObject.SetTextVariable("SETTLEMENT", this.Alley.Settlement.EncyclopediaLinkWithName);
			textObject.SetTextVariable("COMMON_AREA", this.Alley.Name);
			return textObject;
		}

		// Token: 0x060029DA RID: 10714 RVA: 0x000B2843 File Offset: 0x000B0A43
		public override string ToString()
		{
			return this.GetEncyclopediaText().ToString();
		}

		// Token: 0x04000CAA RID: 3242
		[SaveableField(60)]
		public readonly Alley Alley;

		// Token: 0x04000CAB RID: 3243
		[SaveableField(61)]
		public readonly Hero NewOwner;
	}
}
