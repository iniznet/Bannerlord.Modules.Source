using System;
using System.Collections.Generic;
using System.Linq;
using TaleWorlds.CampaignSystem.Issues;
using TaleWorlds.Library;
using TaleWorlds.Localization;
using TaleWorlds.ObjectSystem;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.LogEntries
{
	// Token: 0x020002EC RID: 748
	public class JournalLogEntry : LogEntry
	{
		// Token: 0x06002B40 RID: 11072 RVA: 0x000B6A61 File Offset: 0x000B4C61
		internal static void AutoGeneratedStaticCollectObjectsJournalLogEntry(object o, List<object> collectedObjects)
		{
			((JournalLogEntry)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		// Token: 0x06002B41 RID: 11073 RVA: 0x000B6A70 File Offset: 0x000B4C70
		protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			base.AutoGeneratedInstanceCollectObjects(collectedObjects);
			collectedObjects.Add(this.Title);
			collectedObjects.Add(this.RelatedHero);
			collectedObjects.Add(this.Antagonist);
			collectedObjects.Add(this._entries);
			collectedObjects.Add(this._relatedObjectIds);
		}

		// Token: 0x06002B42 RID: 11074 RVA: 0x000B6AC0 File Offset: 0x000B4CC0
		internal static object AutoGeneratedGetMemberValueTitle(object o)
		{
			return ((JournalLogEntry)o).Title;
		}

		// Token: 0x06002B43 RID: 11075 RVA: 0x000B6ACD File Offset: 0x000B4CCD
		internal static object AutoGeneratedGetMemberValueRelatedHero(object o)
		{
			return ((JournalLogEntry)o).RelatedHero;
		}

		// Token: 0x06002B44 RID: 11076 RVA: 0x000B6ADA File Offset: 0x000B4CDA
		internal static object AutoGeneratedGetMemberValueAntagonist(object o)
		{
			return ((JournalLogEntry)o).Antagonist;
		}

		// Token: 0x06002B45 RID: 11077 RVA: 0x000B6AE7 File Offset: 0x000B4CE7
		internal static object AutoGeneratedGetMemberValueIsSpecial(object o)
		{
			return ((JournalLogEntry)o).IsSpecial;
		}

		// Token: 0x06002B46 RID: 11078 RVA: 0x000B6AF9 File Offset: 0x000B4CF9
		internal static object AutoGeneratedGetMemberValue_entries(object o)
		{
			return ((JournalLogEntry)o)._entries;
		}

		// Token: 0x06002B47 RID: 11079 RVA: 0x000B6B06 File Offset: 0x000B4D06
		internal static object AutoGeneratedGetMemberValue_lastIssueStatus(object o)
		{
			return ((JournalLogEntry)o)._lastIssueStatus;
		}

		// Token: 0x06002B48 RID: 11080 RVA: 0x000B6B18 File Offset: 0x000B4D18
		internal static object AutoGeneratedGetMemberValue_questCompletionDetail(object o)
		{
			return ((JournalLogEntry)o)._questCompletionDetail;
		}

		// Token: 0x06002B49 RID: 11081 RVA: 0x000B6B2A File Offset: 0x000B4D2A
		internal static object AutoGeneratedGetMemberValue_relatedObjectIds(object o)
		{
			return ((JournalLogEntry)o)._relatedObjectIds;
		}

		// Token: 0x17000A85 RID: 2693
		// (get) Token: 0x06002B4A RID: 11082 RVA: 0x000B6B37 File Offset: 0x000B4D37
		public override CampaignTime KeepInHistoryTime
		{
			get
			{
				if (!this.IsSpecial)
				{
					return CampaignTime.Years(1f);
				}
				return CampaignTime.Years(10000f);
			}
		}

		// Token: 0x06002B4B RID: 11083 RVA: 0x000B6B58 File Offset: 0x000B4D58
		public JournalLogEntry(TextObject title, Hero relatedHero, Hero antagonist, bool isSpecial, params MBObjectBase[] relatedObjects)
		{
			this.Title = title;
			this.RelatedHero = relatedHero;
			this.Antagonist = antagonist;
			this._lastIssueStatus = IssueBase.IssueUpdateDetails.None;
			this._questCompletionDetail = QuestBase.QuestCompleteDetails.Invalid;
			this.IsSpecial = isSpecial;
			this._relatedObjectIds = new string[relatedObjects.Length];
			for (int i = 0; i < relatedObjects.Length; i++)
			{
				this._relatedObjectIds[i] = relatedObjects[i].StringId;
			}
		}

		// Token: 0x06002B4C RID: 11084 RVA: 0x000B6BC5 File Offset: 0x000B4DC5
		public bool IsRelatedTo(MBObjectBase obj)
		{
			return this._relatedObjectIds.Contains(obj.StringId);
		}

		// Token: 0x06002B4D RID: 11085 RVA: 0x000B6BD8 File Offset: 0x000B4DD8
		public IEnumerable<JournalLog> GetEntries()
		{
			foreach (JournalLog journalLog in this._entries)
			{
				yield return journalLog;
			}
			List<JournalLog>.Enumerator enumerator = default(List<JournalLog>.Enumerator);
			yield break;
			yield break;
		}

		// Token: 0x06002B4E RID: 11086 RVA: 0x000B6BE8 File Offset: 0x000B4DE8
		public void Update(MBReadOnlyList<JournalLog> entries, IssueBase.IssueUpdateDetails issueStatus = IssueBase.IssueUpdateDetails.None)
		{
			this._entries = entries.ToList<JournalLog>();
			if (issueStatus != IssueBase.IssueUpdateDetails.None)
			{
				this._lastIssueStatus = issueStatus;
			}
		}

		// Token: 0x06002B4F RID: 11087 RVA: 0x000B6C00 File Offset: 0x000B4E00
		public void Update(MBReadOnlyList<JournalLog> entries, QuestBase.QuestCompleteDetails questCompletionDetail)
		{
			this._entries = entries.ToList<JournalLog>();
			this._questCompletionDetail = questCompletionDetail;
		}

		// Token: 0x06002B50 RID: 11088 RVA: 0x000B6C18 File Offset: 0x000B4E18
		public bool IsEndedUnsuccessfully()
		{
			if (this._lastIssueStatus != IssueBase.IssueUpdateDetails.None)
			{
				return this._lastIssueStatus == IssueBase.IssueUpdateDetails.IssueCancel || this._lastIssueStatus == IssueBase.IssueUpdateDetails.IssueFail || this._lastIssueStatus == IssueBase.IssueUpdateDetails.IssueTimedOut || this._lastIssueStatus == IssueBase.IssueUpdateDetails.SentTroopsFailedQuest || this._lastIssueStatus == IssueBase.IssueUpdateDetails.IssueFinishedWithBetrayal;
			}
			return this._questCompletionDetail == QuestBase.QuestCompleteDetails.Cancel || this._questCompletionDetail == QuestBase.QuestCompleteDetails.Fail || this._questCompletionDetail == QuestBase.QuestCompleteDetails.FailWithBetrayal || this._questCompletionDetail == QuestBase.QuestCompleteDetails.Timeout;
		}

		// Token: 0x06002B51 RID: 11089 RVA: 0x000B6C88 File Offset: 0x000B4E88
		public bool IsEnded()
		{
			if (this._lastIssueStatus != IssueBase.IssueUpdateDetails.None)
			{
				return this._lastIssueStatus == IssueBase.IssueUpdateDetails.IssueCancel || this._lastIssueStatus == IssueBase.IssueUpdateDetails.IssueFail || this._lastIssueStatus == IssueBase.IssueUpdateDetails.IssueTimedOut || this._lastIssueStatus == IssueBase.IssueUpdateDetails.IssueFinishedWithBetrayal || this._lastIssueStatus == IssueBase.IssueUpdateDetails.IssueFinishedByAILord || this._lastIssueStatus == IssueBase.IssueUpdateDetails.SentTroopsFinishedQuest || this._lastIssueStatus == IssueBase.IssueUpdateDetails.SentTroopsFailedQuest || this._lastIssueStatus == IssueBase.IssueUpdateDetails.IssueFinishedWithSuccess;
			}
			return this._questCompletionDetail > QuestBase.QuestCompleteDetails.Invalid;
		}

		// Token: 0x06002B52 RID: 11090 RVA: 0x000B6CF3 File Offset: 0x000B4EF3
		public override string ToString()
		{
			return "Quest status change";
		}

		// Token: 0x04000D0D RID: 3341
		[SaveableField(10)]
		public readonly TextObject Title;

		// Token: 0x04000D0E RID: 3342
		[SaveableField(20)]
		public readonly Hero RelatedHero;

		// Token: 0x04000D0F RID: 3343
		[SaveableField(30)]
		public readonly Hero Antagonist;

		// Token: 0x04000D10 RID: 3344
		[SaveableField(40)]
		private List<JournalLog> _entries;

		// Token: 0x04000D11 RID: 3345
		[SaveableField(50)]
		public readonly bool IsSpecial;

		// Token: 0x04000D12 RID: 3346
		[SaveableField(61)]
		private IssueBase.IssueUpdateDetails _lastIssueStatus;

		// Token: 0x04000D13 RID: 3347
		[SaveableField(70)]
		private QuestBase.QuestCompleteDetails _questCompletionDetail;

		// Token: 0x04000D14 RID: 3348
		[SaveableField(80)]
		private readonly string[] _relatedObjectIds;
	}
}
