using System;
using System.Collections.Generic;
using Helpers;
using TaleWorlds.CampaignSystem.Party;
using TaleWorlds.CampaignSystem.Settlements;
using TaleWorlds.Core;
using TaleWorlds.Localization;
using TaleWorlds.ObjectSystem;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.LogEntries
{
	// Token: 0x020002CD RID: 717
	public class BesiegeSettlementLogEntry : LogEntry, IEncyclopediaLog, IChatNotification, IWarLog
	{
		// Token: 0x060029C3 RID: 10691 RVA: 0x000B251E File Offset: 0x000B071E
		internal static void AutoGeneratedStaticCollectObjectsBesiegeSettlementLogEntry(object o, List<object> collectedObjects)
		{
			((BesiegeSettlementLogEntry)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		// Token: 0x060029C4 RID: 10692 RVA: 0x000B252C File Offset: 0x000B072C
		protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			base.AutoGeneratedInstanceCollectObjects(collectedObjects);
			collectedObjects.Add(this.BesiegerHero);
			collectedObjects.Add(this.Settlement);
			collectedObjects.Add(this.BesiegerFaction);
		}

		// Token: 0x060029C5 RID: 10693 RVA: 0x000B2559 File Offset: 0x000B0759
		internal static object AutoGeneratedGetMemberValueBesiegerHero(object o)
		{
			return ((BesiegeSettlementLogEntry)o).BesiegerHero;
		}

		// Token: 0x060029C6 RID: 10694 RVA: 0x000B2566 File Offset: 0x000B0766
		internal static object AutoGeneratedGetMemberValueSettlement(object o)
		{
			return ((BesiegeSettlementLogEntry)o).Settlement;
		}

		// Token: 0x060029C7 RID: 10695 RVA: 0x000B2573 File Offset: 0x000B0773
		internal static object AutoGeneratedGetMemberValueBesiegerFaction(object o)
		{
			return ((BesiegeSettlementLogEntry)o).BesiegerFaction;
		}

		// Token: 0x060029C8 RID: 10696 RVA: 0x000B2580 File Offset: 0x000B0780
		internal static object AutoGeneratedGetMemberValue_isBesiegerArmy(object o)
		{
			return ((BesiegeSettlementLogEntry)o)._isBesiegerArmy;
		}

		// Token: 0x17000A4E RID: 2638
		// (get) Token: 0x060029C9 RID: 10697 RVA: 0x000B2592 File Offset: 0x000B0792
		public bool IsVisibleNotification
		{
			get
			{
				return true;
			}
		}

		// Token: 0x060029CA RID: 10698 RVA: 0x000B2595 File Offset: 0x000B0795
		public BesiegeSettlementLogEntry(MobileParty besiegerParty, Settlement settlement)
		{
			this.BesiegerHero = besiegerParty.Party.Owner;
			this.Settlement = settlement;
			this._isBesiegerArmy = besiegerParty.Army != null;
			this.BesiegerFaction = besiegerParty.MapFaction;
		}

		// Token: 0x060029CB RID: 10699 RVA: 0x000B25D0 File Offset: 0x000B07D0
		public override string ToString()
		{
			return this.GetEncyclopediaText().ToString();
		}

		// Token: 0x060029CC RID: 10700 RVA: 0x000B25E0 File Offset: 0x000B07E0
		public bool IsRelatedToWar(StanceLink stance, out IFaction effector, out IFaction effected)
		{
			IFaction faction = stance.Faction1;
			IFaction faction2 = stance.Faction2;
			effector = this.BesiegerFaction;
			effected = this.Settlement.MapFaction;
			return (this.BesiegerFaction == faction && this.Settlement.MapFaction == faction2) || (this.BesiegerFaction == faction2 && this.Settlement.MapFaction == faction);
		}

		// Token: 0x060029CD RID: 10701 RVA: 0x000B2642 File Offset: 0x000B0842
		public TextObject GetNotificationText()
		{
			TextObject textObject = new TextObject("{=E20BBKYo}{TOWN_NAME} has been besieged by {FACTION_NAME}.", null);
			textObject.SetTextVariable("TOWN_NAME", this.Settlement.EncyclopediaLinkWithName);
			textObject.SetTextVariable("FACTION_NAME", this.BesiegerFaction.EncyclopediaLinkWithName);
			return textObject;
		}

		// Token: 0x060029CE RID: 10702 RVA: 0x000B267D File Offset: 0x000B087D
		public bool IsVisibleInEncyclopediaPageOf<T>(T obj) where T : MBObjectBase
		{
			return obj == this.BesiegerHero || obj == this.Settlement;
		}

		// Token: 0x060029CF RID: 10703 RVA: 0x000B26A0 File Offset: 0x000B08A0
		public TextObject GetEncyclopediaText()
		{
			TextObject textObject;
			if (this._isBesiegerArmy)
			{
				textObject = GameTexts.FindText("str_army_besieging_news_with_link", null);
			}
			else
			{
				textObject = GameTexts.FindText("str_party_besieging_news_with_link", null);
			}
			textObject.SetTextVariable("TOWN_NAME", this.Settlement.EncyclopediaLinkWithName);
			textObject.SetTextVariable("FACTION_NAME", this.BesiegerFaction.EncyclopediaLinkWithName);
			StringHelpers.SetCharacterProperties("LORD", this.BesiegerHero.CharacterObject, textObject, false);
			return textObject;
		}

		// Token: 0x04000CA6 RID: 3238
		[SaveableField(50)]
		public readonly Hero BesiegerHero;

		// Token: 0x04000CA7 RID: 3239
		[SaveableField(51)]
		public readonly Settlement Settlement;

		// Token: 0x04000CA8 RID: 3240
		[SaveableField(53)]
		public readonly IFaction BesiegerFaction;

		// Token: 0x04000CA9 RID: 3241
		[SaveableField(54)]
		private readonly bool _isBesiegerArmy;
	}
}
