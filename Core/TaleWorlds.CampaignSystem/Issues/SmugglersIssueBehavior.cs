using System;
using System.Collections.Generic;
using System.Linq;
using Helpers;
using TaleWorlds.CampaignSystem.Actions;
using TaleWorlds.CampaignSystem.CharacterDevelopment;
using TaleWorlds.CampaignSystem.Conversation;
using TaleWorlds.CampaignSystem.Conversation.Persuasion;
using TaleWorlds.CampaignSystem.Encounters;
using TaleWorlds.CampaignSystem.Extensions;
using TaleWorlds.CampaignSystem.MapEvents;
using TaleWorlds.CampaignSystem.Party;
using TaleWorlds.CampaignSystem.Party.PartyComponents;
using TaleWorlds.CampaignSystem.Roster;
using TaleWorlds.CampaignSystem.Settlements;
using TaleWorlds.Core;
using TaleWorlds.Library;
using TaleWorlds.LinQuick;
using TaleWorlds.Localization;
using TaleWorlds.ObjectSystem;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem.Issues
{
	public class SmugglersIssueBehavior : CampaignBehaviorBase
	{
		public override void RegisterEvents()
		{
			CampaignEvents.OnCheckForIssueEvent.AddNonSerializedListener(this, new Action<Hero>(this.OnCheckForIssue));
		}

		private void OnCheckForIssue(Hero hero)
		{
			Campaign.Current.IssueManager.AddPotentialIssueData(hero, this.ConditionsHold(hero) ? new PotentialIssueData(new PotentialIssueData.StartIssueDelegate(this.OnStartIssue), typeof(SmugglersIssueBehavior.SmugglersIssue), IssueBase.IssueFrequency.Rare, null) : new PotentialIssueData(typeof(SmugglersIssueBehavior.SmugglersIssue), IssueBase.IssueFrequency.Rare));
		}

		private bool ConditionsHold(Hero issueGiver)
		{
			return issueGiver.IsLord && issueGiver.Clan != Clan.PlayerClan && issueGiver.GetRelationWithPlayer() >= -10f && issueGiver.Clan.Settlements.AnyQ((Settlement settlement) => settlement.Owner == issueGiver && settlement.IsTown);
		}

		private IssueBase OnStartIssue(in PotentialIssueData pid, Hero issueOwner)
		{
			return new SmugglersIssueBehavior.SmugglersIssue(issueOwner);
		}

		public override void SyncData(IDataStore dataStore)
		{
		}

		private const IssueBase.IssueFrequency SmugglersIssueFrequency = IssueBase.IssueFrequency.Rare;

		public class SmugglersIssue : IssueBase
		{
			internal static void AutoGeneratedStaticCollectObjectsSmugglersIssue(object o, List<object> collectedObjects)
			{
				((SmugglersIssueBehavior.SmugglersIssue)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
			}

			protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
			{
				base.AutoGeneratedInstanceCollectObjects(collectedObjects);
				collectedObjects.Add(this._targetSettlement);
				collectedObjects.Add(this._originSettlement);
			}

			internal static object AutoGeneratedGetMemberValue_targetSettlement(object o)
			{
				return ((SmugglersIssueBehavior.SmugglersIssue)o)._targetSettlement;
			}

			internal static object AutoGeneratedGetMemberValue_originSettlement(object o)
			{
				return ((SmugglersIssueBehavior.SmugglersIssue)o)._originSettlement;
			}

			public override bool IsThereAlternativeSolution
			{
				get
				{
					return true;
				}
			}

			public override bool IsThereLordSolution
			{
				get
				{
					return false;
				}
			}

			protected override bool IssueQuestCanBeDuplicated
			{
				get
				{
					return false;
				}
			}

			protected override int RewardGold
			{
				get
				{
					return (int)(750f + 3000f * base.IssueDifficultyMultiplier);
				}
			}

			public SmugglersIssue(Hero issueOwner)
				: base(issueOwner, CampaignTime.DaysFromNow(30f))
			{
				SmugglersIssueBehavior.SmugglersIssue <>4__this = this;
				this._targetSettlement = issueOwner.Clan.Settlements.FirstOrDefaultQ((Settlement settlement) => settlement.Owner == issueOwner && settlement.IsTown);
				this._originSettlement = SettlementHelper.FindNearestTown((Settlement town) => town != <>4__this._targetSettlement, this._targetSettlement);
			}

			public override TextObject IssueBriefByIssueGiver
			{
				get
				{
					TextObject textObject = new TextObject("{=bZQQPtJr}{TARGET_SETTLEMENT} has a problem with smugglers. We depend on tariffs for income. People complain, but if we don't collect, then there's no money to keep up the walls and pay the garrison, and believe me if an enemy army came around and pillaged the place because it wasn't defended properly, they'd complain about that too.", null);
					textObject.SetTextVariable("TARGET_SETTLEMENT", this._targetSettlement.Name);
					return textObject;
				}
			}

			public override TextObject IssueAcceptByPlayer
			{
				get
				{
					return new TextObject("{=088shjNR}Go on...", null);
				}
			}

			public override TextObject IssueAlternativeSolutionExplanationByIssueGiver
			{
				get
				{
					TextObject textObject = new TextObject("{=84x0gfUf}I would prefer it if you attended to this yourself. But if you have any companions who can handle a force of {REQUIRED_TROOP_AMOUNT} men, one of them can take care of it.", null);
					textObject.SetTextVariable("REQUIRED_TROOP_AMOUNT", base.GetTotalAlternativeSolutionNeededMenCount());
					return textObject;
				}
			}

			public override TextObject IssueAlternativeSolutionAcceptByPlayer
			{
				get
				{
					return new TextObject("{=tbR8HmFc}No need to worry, I will have my men attend to the matter immediately.", null);
				}
			}

			public override TextObject IssueQuestSolutionExplanationByIssueGiver
			{
				get
				{
					TextObject textObject = new TextObject("{=9jJ0QQYm}I think the reason we have it so bad here is because one gang in particular has good contacts both in {TARGET_SETTLEMENT} and in {ORIGIN_SETTLEMENT}. They've so far managed to elude me, but if you patrol the area between the two cities, you might have better luck. And look - I'd prefer it if you brought them to justice, but if you can persuade them to move elsewhere, I'd settle for that too.", null);
					textObject.SetTextVariable("TARGET_SETTLEMENT", this._targetSettlement.Name);
					textObject.SetTextVariable("ORIGIN_SETTLEMENT", this._originSettlement.Name);
					return textObject;
				}
			}

			public override TextObject IssueQuestSolutionAcceptByPlayer
			{
				get
				{
					return new TextObject("{=acqSONrT}I will handle these smugglers myself.", null);
				}
			}

			public override TextObject IssueAlternativeSolutionResponseByIssueGiver
			{
				get
				{
					return new TextObject("{=g8qb3Ame}Thank you.", null);
				}
			}

			public override TextObject IssueDiscussAlternativeSolution
			{
				get
				{
					return new TextObject("{=RZdL3Mbt}I'm sure your men will take care of those smugglers in no time. I await your good news.", null);
				}
			}

			public override TextObject Title
			{
				get
				{
					TextObject textObject = new TextObject("{=Gop9Khfk}Smugglers of {TARGET_CITY}", null);
					textObject.SetTextVariable("TARGET_CITY", this._targetSettlement.Name);
					return textObject;
				}
			}

			public override TextObject Description
			{
				get
				{
					TextObject textObject = new TextObject("{=pS8Iqeja}{QUEST_GIVER.LINK} is having problems with smugglers in {ORIGIN_CITY}. {?QUEST_GIVER.GENDER}She{?}He{\\?} said that they get their goods from {TARGET_CITY}.", null);
					textObject.SetTextVariable("TARGET_CITY", this._targetSettlement.Name);
					textObject.SetTextVariable("ORIGIN_CITY", this._originSettlement.Name);
					textObject.SetCharacterProperties("QUEST_GIVER", base.IssueOwner.CharacterObject, false);
					return textObject;
				}
			}

			protected override TextObject AlternativeSolutionStartLog
			{
				get
				{
					TextObject textObject = new TextObject("{=bGERUWEr}{ISSUE_GIVER.LINK} {?ISSUE_GIVER.GENDER}lady{?}lord{\\?} of {TARGET_SETTLEMENT} told you that {?ISSUE_GIVER.GENDER}she{?}he{\\?} has been having issues with smugglers running between {TARGET_SETTLEMENT} and {ORIGIN_SETTLEMENT}. You decided to send {COMPANION.LINK} with {TROOP_COUNT} men to find the smugglers. They should return after {RETURN_DAYS} days.", null);
					textObject.SetCharacterProperties("ISSUE_GIVER", base.IssueOwner.CharacterObject, false);
					textObject.SetCharacterProperties("COMPANION", base.AlternativeSolutionHero.CharacterObject, false);
					textObject.SetTextVariable("TARGET_SETTLEMENT", this._targetSettlement.EncyclopediaLinkWithName);
					textObject.SetTextVariable("ORIGIN_SETTLEMENT", this._originSettlement.EncyclopediaLinkWithName);
					textObject.SetTextVariable("TROOP_COUNT", this.AlternativeSolutionSentTroops.TotalManCount - 1);
					textObject.SetTextVariable("RETURN_DAYS", base.GetTotalAlternativeSolutionDurationInDays());
					return textObject;
				}
			}

			public override TextObject IssueAlternativeSolutionSuccessLog
			{
				get
				{
					TextObject textObject = new TextObject("{=QhyB7MX0}Your companion {COMPANION.LINK} and your men return with the news of their success. They dispersed the smugglers as promised to {QUEST_GIVER.LINK}.", null);
					textObject.SetCharacterProperties("COMPANION", base.AlternativeSolutionHero.CharacterObject, false);
					textObject.SetCharacterProperties("QUEST_GIVER", base.IssueOwner.CharacterObject, false);
					return textObject;
				}
			}

			public override TextObject IssueAlternativeSolutionFailLog
			{
				get
				{
					TextObject textObject = new TextObject("{=ExRIMXDV}Your men failed to get rid of the smugglers as you told {QUEST_GIVER.LINK} you would do.", null);
					textObject.SetCharacterProperties("QUEST_GIVER", base.IssueOwner.CharacterObject, false);
					return textObject;
				}
			}

			protected override int CompanionSkillRewardXP
			{
				get
				{
					return 500 + (int)(1000f * base.IssueDifficultyMultiplier);
				}
			}

			public override int AlternativeSolutionBaseNeededMenCount
			{
				get
				{
					return (int)(10f + 20f * base.IssueDifficultyMultiplier);
				}
			}

			protected override int AlternativeSolutionBaseDurationInDaysInternal
			{
				get
				{
					return (int)(7f + 10f * base.IssueDifficultyMultiplier);
				}
			}

			public override IssueBase.AlternativeSolutionScaleFlag AlternativeSolutionScaleFlags
			{
				get
				{
					return IssueBase.AlternativeSolutionScaleFlag.Casualties | IssueBase.AlternativeSolutionScaleFlag.FailureRisk;
				}
			}

			public override ValueTuple<SkillObject, int> GetAlternativeSolutionSkill(Hero hero)
			{
				List<SkillObject> alternativeSolutionMeleeSkills = QuestHelper.GetAlternativeSolutionMeleeSkills();
				alternativeSolutionMeleeSkills.Add(DefaultSkills.Scouting);
				return new ValueTuple<SkillObject, int>(alternativeSolutionMeleeSkills.MaxBy((SkillObject skill) => hero.GetSkillValue(skill)), 150);
			}

			public override bool AlternativeSolutionCondition(out TextObject explanation)
			{
				explanation = TextObject.Empty;
				return QuestHelper.CheckRosterForAlternativeSolution(MobileParty.MainParty.MemberRoster, base.GetTotalAlternativeSolutionNeededMenCount(), ref explanation, 2, false);
			}

			protected override void AlternativeSolutionEndWithSuccessConsequence()
			{
				GiveGoldAction.ApplyBetweenCharacters(null, Hero.MainHero, this.RewardGold, false);
				this.RelationshipChangeWithIssueOwner = 10;
				this._targetSettlement.Town.Security += 10f;
			}

			public override bool DoTroopsSatisfyAlternativeSolution(TroopRoster troopRoster, out TextObject explanation)
			{
				explanation = TextObject.Empty;
				return QuestHelper.CheckRosterForAlternativeSolution(troopRoster, base.GetTotalAlternativeSolutionNeededMenCount(), ref explanation, 2, false);
			}

			public override IssueBase.IssueFrequency GetFrequency()
			{
				return IssueBase.IssueFrequency.Rare;
			}

			public override bool IssueStayAliveConditions()
			{
				return base.IssueOwner.IsAlive && this._targetSettlement.Owner == base.IssueOwner && this._targetSettlement.Town.Security < 80f;
			}

			protected override bool CanPlayerTakeQuestConditions(Hero issueGiver, out IssueBase.PreconditionFlags flag, out Hero relationHero, out SkillObject skill)
			{
				flag = IssueBase.PreconditionFlags.None;
				relationHero = issueGiver;
				skill = null;
				if (issueGiver.GetRelationWithPlayer() < -10f)
				{
					flag |= IssueBase.PreconditionFlags.Relation;
				}
				if (FactionManager.IsAtWarAgainstFaction(issueGiver.MapFaction, Hero.MainHero.MapFaction))
				{
					flag |= IssueBase.PreconditionFlags.AtWar;
				}
				if (MobileParty.MainParty.MemberRoster.TotalManCount <= 10)
				{
					flag |= IssueBase.PreconditionFlags.NotEnoughTroops;
				}
				return flag == IssueBase.PreconditionFlags.None;
			}

			protected override float GetIssueEffectAmountInternal(IssueEffect issueEffect)
			{
				if (issueEffect == DefaultIssueEffects.SettlementLoyalty)
				{
					return -0.1f;
				}
				if (issueEffect == DefaultIssueEffects.SettlementSecurity)
				{
					return -0.5f;
				}
				return 0f;
			}

			protected override void CompleteIssueWithTimedOutConsequences()
			{
			}

			protected override void OnGameLoad()
			{
			}

			protected override QuestBase GenerateIssueQuest(string questId)
			{
				return new SmugglersIssueBehavior.SmugglersIssueQuest(questId, base.IssueOwner, this._targetSettlement, this._originSettlement, base.IssueDifficultyMultiplier, CampaignTime.DaysFromNow(20f), this.RewardGold);
			}

			protected override void HourlyTick()
			{
			}

			[SaveableField(1)]
			private readonly Settlement _targetSettlement;

			[SaveableField(2)]
			private readonly Settlement _originSettlement;

			private const int IssueDuration = 30;

			private const int QuestTimeLimit = 20;

			private const int CompanionRequiredSkillLevel = 150;

			private const int AlternativeSolutionMinimumTroopLevel = 2;

			private const int SuccessRelationBonus = 10;

			private const int SuccessSecurityBonus = 10;

			private const int TroopsRequiredForQuest = 10;
		}

		public class SmugglersIssueQuest : QuestBase
		{
			internal static void AutoGeneratedStaticCollectObjectsSmugglersIssueQuest(object o, List<object> collectedObjects)
			{
				((SmugglersIssueBehavior.SmugglersIssueQuest)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
			}

			protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
			{
				base.AutoGeneratedInstanceCollectObjects(collectedObjects);
				collectedObjects.Add(this._targetSettlement);
				collectedObjects.Add(this._originSettlement);
				collectedObjects.Add(this._smugglerParty);
			}

			internal static object AutoGeneratedGetMemberValue_targetSettlement(object o)
			{
				return ((SmugglersIssueBehavior.SmugglersIssueQuest)o)._targetSettlement;
			}

			internal static object AutoGeneratedGetMemberValue_originSettlement(object o)
			{
				return ((SmugglersIssueBehavior.SmugglersIssueQuest)o)._originSettlement;
			}

			internal static object AutoGeneratedGetMemberValue_smugglerParty(object o)
			{
				return ((SmugglersIssueBehavior.SmugglersIssueQuest)o)._smugglerParty;
			}

			internal static object AutoGeneratedGetMemberValue_issueDifficulty(object o)
			{
				return ((SmugglersIssueBehavior.SmugglersIssueQuest)o)._issueDifficulty;
			}

			internal static object AutoGeneratedGetMemberValue_smugglerSettlementWaitCounter(object o)
			{
				return ((SmugglersIssueBehavior.SmugglersIssueQuest)o)._smugglerSettlementWaitCounter;
			}

			private int BribeAmount
			{
				get
				{
					return (int)((float)this.RewardGold * 0.75f);
				}
			}

			private int SmugglerPartySize
			{
				get
				{
					return (int)((float)MobileParty.MainParty.MemberRoster.TotalManCount * 0.8f * this._issueDifficulty);
				}
			}

			public override bool IsRemainingTimeHidden
			{
				get
				{
					return false;
				}
			}

			private TextObject QuestStartedLog
			{
				get
				{
					TextObject textObject = new TextObject("{=R98gwuK1}{QUEST_GIVER.LINK} {?QUEST_GIVER.GENDER}lady{?}lord{\\?} of {TARGET_SETTLEMENT} told you that {?QUEST_GIVER.GENDER}she{?}he{\\?} has been having issues with smugglers running between {TARGET_SETTLEMENT} and {ORIGIN_SETTLEMENT}. You promised to track the smugglers down and chase them away from {TARGET_SETTLEMENT}.", null);
					textObject.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, false);
					textObject.SetTextVariable("TARGET_SETTLEMENT", this._targetSettlement.EncyclopediaLinkWithName);
					textObject.SetTextVariable("ORIGIN_SETTLEMENT", this._originSettlement.EncyclopediaLinkWithName);
					return textObject;
				}
			}

			private TextObject QuestCanceledWarDeclaredLog
			{
				get
				{
					TextObject textObject = new TextObject("{=vW6kBki9}Your clan is now at war with {QUEST_GIVER.LINK}'s realm. Your agreement with {QUEST_GIVER.LINK} is canceled.", null);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					return textObject;
				}
			}

			private TextObject QuestCanceledSettlementOwnerChangedLog
			{
				get
				{
					TextObject textObject = new TextObject("{=xSaVRIN7}{QUEST_GIVER.LINK} has lost the ownership of {TARGET_CITY}. Your agreement with {QUEST_GIVER.LINK} is canceled.", null);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					textObject.SetTextVariable("TARGET_CITY", this._targetSettlement.EncyclopediaLinkWithName);
					return textObject;
				}
			}

			private TextObject QuestFailedLog
			{
				get
				{
					TextObject textObject = new TextObject("{=QB4bKAVR}You failed to get rid of the smugglers as you told {QUEST_GIVER.LINK} you would do.", null);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					return textObject;
				}
			}

			private TextObject QuestSuccessWithFightLog
			{
				get
				{
					TextObject textObject = new TextObject("{=7N8jdPdV}You got rid of the smugglers as you promised {QUEST_GIVER.LINK} you would do.", null);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					return textObject;
				}
			}

			private TextObject QuestSuccessWithPersuasionLog
			{
				get
				{
					TextObject textObject = new TextObject("{=84ZwbJaq}You persuaded the smugglers to move away from {TARGET_SETTLEMENT}. They are now far away from {TARGET_SETTLEMENT} and {QUEST_GIVER.LINK} is satisfied.", null);
					textObject.SetTextVariable("TARGET_SETTLEMENT", this._targetSettlement.Name);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					return textObject;
				}
			}

			private TextObject QuestSuccessWithBribeLog
			{
				get
				{
					TextObject textObject = new TextObject("{=Ici6us1S}You paid the smugglers to move away from {TARGET_SETTLEMENT}. They are now far away and {QUEST_GIVER.LINK} is satisfied.", null);
					textObject.SetTextVariable("TARGET_SETTLEMENT", this._targetSettlement.Name);
					StringHelpers.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, textObject, false);
					return textObject;
				}
			}

			public override TextObject Title
			{
				get
				{
					TextObject textObject = new TextObject("{=Gop9Khfk}Smugglers of {TARGET_CITY}", null);
					textObject.SetTextVariable("TARGET_CITY", this._targetSettlement.Name);
					return textObject;
				}
			}

			public SmugglersIssueQuest(string questId, Hero questGiver, Settlement targetSettlement, Settlement originSettlement, float issueDifficulty, CampaignTime duration, int rewardGold)
				: base(questId, questGiver, duration, rewardGold)
			{
				this._targetSettlement = targetSettlement;
				this._originSettlement = originSettlement;
				this._issueDifficulty = issueDifficulty;
				this.SetDialogs();
				base.InitializeQuestOnCreation();
			}

			protected override void SetDialogs()
			{
				TextObject textObject = new TextObject("{=g8qb3Ame}Thank you.", null);
				TextObject textObject2 = new TextObject("{=KLkaBjy7}I'm glad you're taking care of those smugglers.", null);
				this.OfferDialogFlow = DialogFlow.CreateDialogFlow("issue_classic_quest_start", 100).NpcLine(textObject, null, null).Condition(() => Hero.OneToOneConversationHero == base.QuestGiver)
					.Consequence(new ConversationSentence.OnConsequenceDelegate(this.QuestAcceptedConsequences))
					.CloseDialog();
				this.DiscussDialogFlow = DialogFlow.CreateDialogFlow("quest_discuss", 100).NpcLine(textObject2, null, null).Condition(() => Hero.OneToOneConversationHero == base.QuestGiver)
					.Consequence(delegate
					{
						Campaign.Current.ConversationManager.ConversationEndOneShot += MapEventHelper.OnConversationEnd;
					})
					.CloseDialog();
				DialogFlow smugglerPartyDialog = this.GetSmugglerPartyDialog();
				this.AddPersuasionDialogs(smugglerPartyDialog);
				Campaign.Current.ConversationManager.AddDialogFlow(smugglerPartyDialog, this);
			}

			private DialogFlow GetSmugglerPartyDialog()
			{
				TextObject textObject = new TextObject("{=EUJaTe2v}Who are you? What do you want from us?", null);
				TextObject textObject2 = new TextObject("{=4iEQr3il}Halt. You're wanted by the authorities in {TARGET_SETTLEMENT} for smuggling.", null);
				textObject2.SetTextVariable("TARGET_SETTLEMENT", this._targetSettlement.Name);
				TextObject textObject3 = new TextObject("{=vo8fmqwC}Hey... We're just honest traders here, trying to get by in these hard times.", null);
				TextObject textObject4 = new TextObject("{=qa3xzdbO}I think not. I'm going to give you one chance to leave this district, and never come back under pain of death.", null);
				TextObject textObject5 = new TextObject("{=BRaGcALd}Hah! Now why would we do that?", null);
				TextObject textObject6 = new TextObject("{=Ga5E2saO}Because it would be easier to work elsewhere.", null);
				TextObject textObject7 = new TextObject("{=722uabab}Because if you don't, I'll cut you down right here and now.", null);
				TextObject textObject8 = new TextObject("{=8dys8maS}Oh is that so? This will be fun.", null);
				TextObject textObject9 = new TextObject("{=WwzniBzk}Because I'll pay you. Silver is better than death, isn't it?", null);
				TextObject textObject10 = new TextObject("{=aABDmDJk}Heh, I like the way you think. Fine. It's become too risky around these parts anyway. You won't see us near {TARGET_SETTLEMENT} again.", null);
				textObject10.SetTextVariable("TARGET_SETTLEMENT", this._targetSettlement.Name);
				return DialogFlow.CreateDialogFlow("start", 125).NpcLine(textObject, null, null).Condition(() => this._smugglerParty != null && CharacterObject.OneToOneConversationCharacter == ConversationHelper.GetConversationCharacterPartyLeader(this._smugglerParty.Party))
					.Consequence(delegate
					{
						this._task = this.GetPersuasionTask();
					})
					.PlayerLine(textObject2, null)
					.NpcLine(textObject3, null, null)
					.PlayerLine(textObject4, null)
					.NpcLine(textObject5, null, null)
					.BeginPlayerOptions()
					.PlayerOption(textObject6, null)
					.GotoDialogState("start_smugglers_persuasion")
					.PlayerOption(textObject7, null)
					.NpcLine(textObject8, null, null)
					.Consequence(delegate
					{
						EncounterManager.StartPartyEncounter(PartyBase.MainParty, this._smugglerParty.Party);
						Campaign.Current.GameMenuManager.SetNextMenu("encounter");
					})
					.CloseDialog()
					.PlayerOption(textObject9, null)
					.ClickableCondition(new ConversationSentence.OnClickableConditionDelegate(this.BribeCondition))
					.NpcLine(textObject10, null, null)
					.Consequence(new ConversationSentence.OnConsequenceDelegate(this.SucceedQuestWithBribe))
					.CloseDialog()
					.EndPlayerOptions()
					.CloseDialog();
			}

			private PersuasionTask GetPersuasionTask()
			{
				PersuasionTask persuasionTask = new PersuasionTask(0);
				persuasionTask.FinalFailLine = new TextObject("{=iRarm6f7}We are not going anywhere friend. You're going to have to fight for your silver today.", null);
				persuasionTask.TryLaterLine = TextObject.Empty;
				persuasionTask.SpokenLine = new TextObject("{=xnT03Yv0}I'm listening.", null);
				TextObject textObject = new TextObject("{=gtY7QuX0}{QUEST_GIVER.LINK} is on to you. I can guarantee you the time of easy pickings and low risk is over.", null);
				textObject.SetCharacterProperties("QUEST_GIVER", base.QuestGiver.CharacterObject, false);
				TextObject textObject2 = new TextObject("{=T7bMlcj3}Prices in {TARGET_SETTLEMENT} are down these days. Enterprising lads like you can do better elsewhere.", null);
				textObject2.SetTextVariable("TARGET_SETTLEMENT", this._targetSettlement.Name);
				TextObject textObject3 = new TextObject("{=6cbdm02F}Because if you make me angry, you'll wish you were dead long before I actually kill you.", null);
				PersuasionOptionArgs persuasionOptionArgs = new PersuasionOptionArgs(DefaultSkills.Roguery, DefaultTraits.Valor, TraitEffect.Positive, PersuasionArgumentStrength.Hard, true, textObject, null, false, false, false);
				PersuasionOptionArgs persuasionOptionArgs2 = new PersuasionOptionArgs(DefaultSkills.Trade, DefaultTraits.Calculating, TraitEffect.Positive, PersuasionArgumentStrength.VeryEasy, false, textObject2, null, false, false, false);
				PersuasionOptionArgs persuasionOptionArgs3 = new PersuasionOptionArgs(DefaultSkills.Roguery, DefaultTraits.Mercy, TraitEffect.Negative, PersuasionArgumentStrength.VeryHard, false, textObject3, null, false, false, false);
				persuasionTask.AddOptionToTask(persuasionOptionArgs);
				persuasionTask.AddOptionToTask(persuasionOptionArgs2);
				persuasionTask.AddOptionToTask(persuasionOptionArgs3);
				return persuasionTask;
			}

			private void AddPersuasionDialogs(DialogFlow dialog)
			{
				dialog.AddDialogLine("smugglers_persuasion_check_accepted", "start_smugglers_persuasion", "smugglers_persuasion_start_reservation", "{=6P1ruzsC}Maybe...", new ConversationSentence.OnConditionDelegate(this.persuasion_start_with_smugglers_on_condition), new ConversationSentence.OnConsequenceDelegate(this.persuasion_start_with_smugglers_on_consequence), this, 100, null, null, null);
				dialog.AddDialogLine("smugglers_persuasion_rejected", "smugglers_persuasion_start_reservation", "close_window", "{=!}{FAILED_PERSUASION_LINE}", new ConversationSentence.OnConditionDelegate(this.persuasion_failed_with_smugglers_on_condition), new ConversationSentence.OnConsequenceDelegate(this.persuasion_rejected_with_smugglers_on_consequence), this, 100, null, null, null);
				dialog.AddDialogLine("smugglers_persuasion_attempt", "smugglers_persuasion_start_reservation", "smugglers_persuasion_select_option", "{=wM77S68a}What's there to discuss?", () => !this.persuasion_failed_with_smugglers_on_condition(), null, this, 100, null, null, null);
				dialog.AddDialogLine("smugglers_persuasion_success", "smugglers_persuasion_start_reservation", "close_window", "{=m61UnySr}Yeah, you make a good point. If you find us, others can too. We will move elsewhere.", new ConversationSentence.OnConditionDelegate(ConversationManager.GetPersuasionProgressSatisfied), new ConversationSentence.OnConsequenceDelegate(this.persuasion_complete_with_smugglers_on_consequence), this, 200, null, null, null);
				string text = "smugglers_persuasion_select_option_1";
				string text2 = "smugglers_persuasion_select_option";
				string text3 = "smugglers_persuasion_selected_option_response";
				string text4 = "{=!}{smugglers_PERSUADE_ATTEMPT_1}";
				ConversationSentence.OnConditionDelegate onConditionDelegate = new ConversationSentence.OnConditionDelegate(this.smugglers_persuasion_select_option_1_on_condition);
				ConversationSentence.OnConsequenceDelegate onConsequenceDelegate = new ConversationSentence.OnConsequenceDelegate(this.smugglers_persuasion_select_option_1_on_consequence);
				ConversationSentence.OnPersuasionOptionDelegate onPersuasionOptionDelegate = new ConversationSentence.OnPersuasionOptionDelegate(this.smugglers_persuasion_setup_option_1);
				ConversationSentence.OnClickableConditionDelegate onClickableConditionDelegate = new ConversationSentence.OnClickableConditionDelegate(this.smugglers_persuasion_clickable_option_1_on_condition);
				dialog.AddPlayerLine(text, text2, text3, text4, onConditionDelegate, onConsequenceDelegate, this, 100, onClickableConditionDelegate, onPersuasionOptionDelegate, null, null);
				string text5 = "smugglers_persuasion_select_option_2";
				string text6 = "smugglers_persuasion_select_option";
				string text7 = "smugglers_persuasion_selected_option_response";
				string text8 = "{=!}{smugglers_PERSUADE_ATTEMPT_2}";
				ConversationSentence.OnConditionDelegate onConditionDelegate2 = new ConversationSentence.OnConditionDelegate(this.smugglers_persuasion_select_option_2_on_condition);
				ConversationSentence.OnConsequenceDelegate onConsequenceDelegate2 = new ConversationSentence.OnConsequenceDelegate(this.smugglers_persuasion_select_option_2_on_consequence);
				onPersuasionOptionDelegate = new ConversationSentence.OnPersuasionOptionDelegate(this.smugglers_persuasion_setup_option_2);
				onClickableConditionDelegate = new ConversationSentence.OnClickableConditionDelegate(this.smugglers_persuasion_clickable_option_2_on_condition);
				dialog.AddPlayerLine(text5, text6, text7, text8, onConditionDelegate2, onConsequenceDelegate2, this, 100, onClickableConditionDelegate, onPersuasionOptionDelegate, null, null);
				string text9 = "smugglers_persuasion_select_option_3";
				string text10 = "smugglers_persuasion_select_option";
				string text11 = "smugglers_persuasion_selected_option_response";
				string text12 = "{=!}{smugglers_PERSUADE_ATTEMPT_3}";
				ConversationSentence.OnConditionDelegate onConditionDelegate3 = new ConversationSentence.OnConditionDelegate(this.smugglers_persuasion_select_option_3_on_condition);
				ConversationSentence.OnConsequenceDelegate onConsequenceDelegate3 = new ConversationSentence.OnConsequenceDelegate(this.smugglers_persuasion_select_option_3_on_consequence);
				onPersuasionOptionDelegate = new ConversationSentence.OnPersuasionOptionDelegate(this.smugglers_persuasion_setup_option_3);
				onClickableConditionDelegate = new ConversationSentence.OnClickableConditionDelegate(this.smugglers_persuasion_clickable_option_3_on_condition);
				dialog.AddPlayerLine(text9, text10, text11, text12, onConditionDelegate3, onConsequenceDelegate3, this, 100, onClickableConditionDelegate, onPersuasionOptionDelegate, null, null);
				dialog.AddDialogLine("smugglers_persuasion_select_option_reaction", "smugglers_persuasion_selected_option_response", "smugglers_persuasion_start_reservation", "{=!}{PERSUASION_REACTION}", new ConversationSentence.OnConditionDelegate(this.smugglers_persuasion_selected_option_response_on_condition), new ConversationSentence.OnConsequenceDelegate(this.smugglers_persuasion_selected_option_response_on_consequence), this, 100, null, null, null);
			}

			private void persuasion_start_with_smugglers_on_consequence()
			{
				ConversationManager.StartPersuasion(2f, 1f, 0f, 2f, 2f, 0f, PersuasionDifficulty.MediumHard);
			}

			private bool persuasion_start_with_smugglers_on_condition()
			{
				return this._smugglerParty != null && CharacterObject.OneToOneConversationCharacter == ConversationHelper.GetConversationCharacterPartyLeader(this._smugglerParty.Party);
			}

			private bool smugglers_persuasion_selected_option_response_on_condition()
			{
				PersuasionOptionResult item = ConversationManager.GetPersuasionChosenOptions().Last<Tuple<PersuasionOptionArgs, PersuasionOptionResult>>().Item2;
				MBTextManager.SetTextVariable("PERSUASION_REACTION", PersuasionHelper.GetDefaultPersuasionOptionReaction(item), false);
				if (item == PersuasionOptionResult.CriticalFailure)
				{
					this._task.BlockAllOptions();
				}
				return true;
			}

			private void smugglers_persuasion_selected_option_response_on_consequence()
			{
				Tuple<PersuasionOptionArgs, PersuasionOptionResult> tuple = ConversationManager.GetPersuasionChosenOptions().Last<Tuple<PersuasionOptionArgs, PersuasionOptionResult>>();
				float difficulty = Campaign.Current.Models.PersuasionModel.GetDifficulty(PersuasionDifficulty.MediumHard);
				float num;
				float num2;
				Campaign.Current.Models.PersuasionModel.GetEffectChances(tuple.Item1, out num, out num2, difficulty);
				this._task.ApplyEffects(num, num2);
			}

			private bool smugglers_persuasion_select_option_1_on_condition()
			{
				if (this._task.Options.Count > 0)
				{
					TextObject textObject = new TextObject("{=bSo9hKwr}{PERSUASION_OPTION_LINE} {SUCCESS_CHANCE}", null);
					textObject.SetTextVariable("SUCCESS_CHANCE", PersuasionHelper.ShowSuccess(this._task.Options.ElementAt(0), false));
					textObject.SetTextVariable("PERSUASION_OPTION_LINE", this._task.Options.ElementAt(0).Line);
					MBTextManager.SetTextVariable("smugglers_PERSUADE_ATTEMPT_1", textObject, false);
					return true;
				}
				return false;
			}

			private bool smugglers_persuasion_select_option_2_on_condition()
			{
				if (this._task.Options.Count > 1)
				{
					TextObject textObject = new TextObject("{=bSo9hKwr}{PERSUASION_OPTION_LINE} {SUCCESS_CHANCE}", null);
					textObject.SetTextVariable("SUCCESS_CHANCE", PersuasionHelper.ShowSuccess(this._task.Options.ElementAt(1), false));
					textObject.SetTextVariable("PERSUASION_OPTION_LINE", this._task.Options.ElementAt(1).Line);
					MBTextManager.SetTextVariable("smugglers_PERSUADE_ATTEMPT_2", textObject, false);
					return true;
				}
				return false;
			}

			private bool smugglers_persuasion_select_option_3_on_condition()
			{
				if (this._task.Options.Count > 2)
				{
					TextObject textObject = new TextObject("{=bSo9hKwr}{PERSUASION_OPTION_LINE} {SUCCESS_CHANCE}", null);
					textObject.SetTextVariable("SUCCESS_CHANCE", PersuasionHelper.ShowSuccess(this._task.Options.ElementAt(2), false));
					textObject.SetTextVariable("PERSUASION_OPTION_LINE", this._task.Options.ElementAt(2).Line);
					MBTextManager.SetTextVariable("smugglers_PERSUADE_ATTEMPT_3", textObject, false);
					return true;
				}
				return false;
			}

			private void smugglers_persuasion_select_option_1_on_consequence()
			{
				if (this._task.Options.Count > 0)
				{
					this._task.Options[0].BlockTheOption(true);
				}
			}

			private void smugglers_persuasion_select_option_2_on_consequence()
			{
				if (this._task.Options.Count > 1)
				{
					this._task.Options[1].BlockTheOption(true);
				}
			}

			private void smugglers_persuasion_select_option_3_on_consequence()
			{
				if (this._task.Options.Count > 2)
				{
					this._task.Options[2].BlockTheOption(true);
				}
			}

			private bool persuasion_failed_with_smugglers_on_condition()
			{
				if (this._task.Options.All((PersuasionOptionArgs x) => x.IsBlocked) && !ConversationManager.GetPersuasionProgressSatisfied())
				{
					MBTextManager.SetTextVariable("FAILED_PERSUASION_LINE", this._task.FinalFailLine, false);
					return true;
				}
				return false;
			}

			private PersuasionOptionArgs smugglers_persuasion_setup_option_1()
			{
				return this._task.Options.ElementAt(0);
			}

			private PersuasionOptionArgs smugglers_persuasion_setup_option_2()
			{
				return this._task.Options.ElementAt(1);
			}

			private PersuasionOptionArgs smugglers_persuasion_setup_option_3()
			{
				return this._task.Options.ElementAt(2);
			}

			private bool smugglers_persuasion_clickable_option_1_on_condition(out TextObject hintText)
			{
				hintText = new TextObject("{=9ACJsI6S}Blocked", null);
				if (this._task.Options.Count > 0)
				{
					hintText = (this._task.Options.ElementAt(0).IsBlocked ? hintText : TextObject.Empty);
					return !this._task.Options.ElementAt(0).IsBlocked;
				}
				return false;
			}

			private bool smugglers_persuasion_clickable_option_2_on_condition(out TextObject hintText)
			{
				hintText = new TextObject("{=9ACJsI6S}Blocked", null);
				if (this._task.Options.Count > 1)
				{
					hintText = (this._task.Options.ElementAt(1).IsBlocked ? hintText : TextObject.Empty);
					return !this._task.Options.ElementAt(1).IsBlocked;
				}
				return false;
			}

			private bool smugglers_persuasion_clickable_option_3_on_condition(out TextObject hintText)
			{
				hintText = new TextObject("{=9ACJsI6S}Blocked", null);
				if (this._task.Options.Count > 2)
				{
					hintText = (this._task.Options.ElementAt(2).IsBlocked ? hintText : TextObject.Empty);
					return !this._task.Options.ElementAt(2).IsBlocked;
				}
				return false;
			}

			private void persuasion_rejected_with_smugglers_on_consequence()
			{
				PlayerEncounter.LeaveEncounter = false;
				ConversationManager.EndPersuasion();
			}

			private void persuasion_complete_with_smugglers_on_consequence()
			{
				PlayerEncounter.LeaveEncounter = true;
				ConversationManager.EndPersuasion();
				Campaign.Current.ConversationManager.ConversationEndOneShot += delegate
				{
					this.SucceedQuest(this.QuestSuccessWithPersuasionLog);
				};
			}

			private bool BribeCondition(out TextObject explanation)
			{
				if (Hero.MainHero.Gold >= this.BribeAmount)
				{
					explanation = new TextObject("{=FebKjriO}You will give {BRIBE_AMOUNT} denars.", null);
					explanation.SetTextVariable("BRIBE_AMOUNT", this.BribeAmount);
					return true;
				}
				explanation = new TextObject("{=Xy4brTbf}You don't have {BRIBE_AMOUNT} denars.", null);
				explanation.SetTextVariable("BRIBE_AMOUNT", this.BribeAmount);
				return false;
			}

			private void QuestAcceptedConsequences()
			{
				base.StartQuest();
				base.AddLog(this.QuestStartedLog, false);
				this._smugglerParty = this.CreateSmugglerParty();
				base.AddTrackedObject(this._targetSettlement);
				base.AddTrackedObject(this._originSettlement);
			}

			private MobileParty CreateSmugglerParty()
			{
				TextObject textObject = new TextObject("{=3dhAfC4k}Smugglers of {ORIGIN_SETTLEMENT}", null);
				textObject.SetTextVariable("ORIGIN_SETTLEMENT", this._originSettlement.Name);
				TroopRoster.CreateDummyTroopRoster();
				TroopRoster.CreateDummyTroopRoster();
				string text;
				string text2;
				this.GetAdditionalVisualsForParty(this._originSettlement.Culture, out text, out text2);
				Settlement nearestHideoutSettlement = SettlementHelper.FindNearestHideout(null, null);
				int num = (int)MathF.Clamp((float)MathF.Ceiling((float)MobileParty.MainParty.MemberRoster.TotalManCount * 0.8f), 15f, 35f);
				float num2 = MobileParty.MainParty.Speed * 1.1f;
				MobileParty mobileParty = CustomPartyComponent.CreateQuestParty(this._originSettlement.GatePosition, 0.1f, this._originSettlement, textObject, Clan.BanditFactions.FirstOrDefault((Clan faction) => faction.Culture == nearestHideoutSettlement.Culture), this._originSettlement.Culture.CaravanPartyTemplate, null, num, text, text2, num2, true);
				CharacterObject @object = MBObjectManager.Instance.GetObject<CharacterObject>("nervous_caravanmaster_" + MBRandom.RandomInt(1, 4));
				mobileParty.MemberRoster.AddToCounts(@object, 1, true, 0, 0, true, -1);
				this.GiveGoodsToParty(mobileParty);
				this.InitializePartyState(mobileParty);
				mobileParty.SetPartyUsedByQuest(true);
				return mobileParty;
			}

			private void GetAdditionalVisualsForParty(CultureObject culture, out string mountStringId, out string harnessStringId)
			{
				if (culture.StringId == "aserai" || culture.StringId == "khuzait")
				{
					mountStringId = "camel";
					harnessStringId = ((MBRandom.RandomFloat > 0.5f) ? "camel_saddle_a" : "camel_saddle_b");
					return;
				}
				mountStringId = "mule";
				harnessStringId = ((MBRandom.RandomFloat > 0.5f) ? "mule_load_a" : ((MBRandom.RandomFloat > 0.5f) ? "mule_load_b" : "mule_load_c"));
			}

			private void GiveGoodsToParty(MobileParty mobileParty)
			{
				int num = MathF.Ceiling(400f + 3000f * this._issueDifficulty);
				ItemObject @object = MBObjectManager.Instance.GetObject<ItemObject>(this._possibleSmuggledItems.GetRandomElement<string>());
				int num2 = num / @object.Value;
				mobileParty.ItemRoster.AddToCounts(@object, num2);
				mobileParty.ItemRoster.AddToCounts(MBObjectManager.Instance.GetObject<ItemObject>("grain"), MathF.Ceiling(30f + 20f * this._issueDifficulty));
			}

			private void InitializePartyState(MobileParty mobileParty)
			{
				TextObject textObject = new TextObject("{=GTnVcUz9}Smugglers' Party", null);
				mobileParty.InitializeMobilePartyAtPosition(new TroopRoster(mobileParty.Party), new TroopRoster(mobileParty.Party), this._originSettlement.GatePosition);
				mobileParty.SetCustomName(textObject);
				mobileParty.Ai.SetDoNotMakeNewDecisions(true);
				mobileParty.IgnoreByOtherPartiesTill(CampaignTime.Never);
				mobileParty.SetCustomHomeSettlement(this._originSettlement);
				SetPartyAiAction.GetActionForVisitingSettlement(mobileParty, this._targetSettlement);
			}

			protected override void OnTimedOut()
			{
				this.FailQuest();
			}

			private void SucceedQuestWithBribe()
			{
				PlayerEncounter.LeaveEncounter = true;
				GiveGoldAction.ApplyForQuestBetweenCharacters(Hero.MainHero, null, this.BribeAmount, false);
				this.SucceedQuest(this.QuestSuccessWithBribeLog);
			}

			private void SucceedQuest(TextObject log)
			{
				base.AddLog(log, false);
				base.RemoveTrackedObject(this._targetSettlement);
				base.RemoveTrackedObject(this._originSettlement);
				this.RelationshipChangeWithQuestGiver = 10;
				this._targetSettlement.Town.Security += 10f;
				GiveGoldAction.ApplyForQuestBetweenCharacters(base.QuestGiver, Hero.MainHero, this.RewardGold, false);
				if (this._smugglerParty != null)
				{
					DestroyPartyAction.Apply(null, this._smugglerParty);
				}
				base.CompleteQuestWithSuccess();
			}

			private void FailQuest()
			{
				TraitLevelingHelper.OnIssueFailed(Hero.MainHero, new Tuple<TraitObject, int>[]
				{
					new Tuple<TraitObject, int>(DefaultTraits.Honor, -50),
					new Tuple<TraitObject, int>(DefaultTraits.Valor, -50)
				});
				this.RelationshipChangeWithQuestGiver = -10;
				base.RemoveTrackedObject(this._targetSettlement);
				base.RemoveTrackedObject(this._originSettlement);
				base.CompleteQuestWithFail(this.QuestFailedLog);
				DestroyPartyAction.Apply(null, this._smugglerParty);
			}

			protected override void RegisterEvents()
			{
				CampaignEvents.OnSettlementOwnerChangedEvent.AddNonSerializedListener(this, new Action<Settlement, bool, Hero, Hero, Hero, ChangeOwnerOfSettlementAction.ChangeOwnerOfSettlementDetail>(this.OnSettlementOwnerChanged));
				CampaignEvents.WarDeclared.AddNonSerializedListener(this, new Action<IFaction, IFaction, DeclareWarAction.DeclareWarDetail>(this.OnWarDeclared));
				CampaignEvents.ClanChangedKingdom.AddNonSerializedListener(this, new Action<Clan, Kingdom, Kingdom, ChangeKingdomAction.ChangeKingdomActionDetail, bool>(this.OnClanChangedKingdom));
				CampaignEvents.HourlyTickPartyEvent.AddNonSerializedListener(this, new Action<MobileParty>(this.OnHourlyTickParty));
				CampaignEvents.MapEventEnded.AddNonSerializedListener(this, new Action<MapEvent>(this.OnMapEventEnded));
			}

			private void OnMapEventEnded(MapEvent mapEvent)
			{
				if (mapEvent.IsPlayerMapEvent && mapEvent.InvolvedParties.Contains(this._smugglerParty.Party))
				{
					if (mapEvent.WinningSide == mapEvent.PlayerSide)
					{
						this.SucceedQuest(this.QuestSuccessWithFightLog);
						return;
					}
					this.FailQuest();
				}
			}

			private void OnHourlyTickParty(MobileParty mobileParty)
			{
				if (mobileParty == this._smugglerParty && mobileParty.CurrentSettlement != null)
				{
					if (this._smugglerSettlementWaitCounter >= 4)
					{
						this._smugglerSettlementWaitCounter = 0;
						Settlement settlement = ((mobileParty.CurrentSettlement == this._targetSettlement) ? this._originSettlement : this._targetSettlement);
						SetPartyAiAction.GetActionForVisitingSettlement(mobileParty, settlement);
						return;
					}
					this._smugglerSettlementWaitCounter++;
				}
			}

			private void OnClanChangedKingdom(Clan clan, Kingdom oldKingdom, Kingdom newKingdom, ChangeKingdomAction.ChangeKingdomActionDetail detail, bool showNotification = true)
			{
				if (clan == base.QuestGiver.Clan && newKingdom.IsAtWarWith(Clan.PlayerClan))
				{
					base.CompleteQuestWithCancel(this.QuestCanceledWarDeclaredLog);
				}
			}

			private void OnWarDeclared(IFaction faction1, IFaction faction2, DeclareWarAction.DeclareWarDetail declareWarDetail)
			{
				QuestHelper.CheckWarDeclarationAndFailOrCancelTheQuest(this, faction1, faction2, declareWarDetail, this.QuestCanceledWarDeclaredLog, this.QuestCanceledWarDeclaredLog, false);
			}

			private void OnSettlementOwnerChanged(Settlement settlement, bool openToClaim, Hero newOwner, Hero oldOwner, Hero capturerHero, ChangeOwnerOfSettlementAction.ChangeOwnerOfSettlementDetail detail)
			{
				if (settlement == this._targetSettlement)
				{
					base.CompleteQuestWithCancel(this.QuestCanceledSettlementOwnerChangedLog);
				}
			}

			protected override void InitializeQuestOnGameLoad()
			{
				this.SetDialogs();
			}

			protected override void HourlyTick()
			{
			}

			[SaveableField(1)]
			private readonly Settlement _targetSettlement;

			[SaveableField(2)]
			private readonly Settlement _originSettlement;

			[SaveableField(3)]
			private MobileParty _smugglerParty;

			[SaveableField(4)]
			private readonly float _issueDifficulty;

			[SaveableField(5)]
			private int _smugglerSettlementWaitCounter;

			private const int FailRelationPenalty = -10;

			private const int SuccessRelationBonus = 10;

			private const int SuccessSecurityBonus = 10;

			private const int MaxSmugglerPartySize = 35;

			private const int MinSmugglerPartySize = 15;

			private const int SmugglerPartyWaitingHours = 4;

			private const string SmugglerPersuasionDialogToken = "start_smugglers_persuasion";

			private readonly string[] _possibleSmuggledItems = new string[] { "jewelry", "spice", "velvet", "fur" };

			private PersuasionTask _task;

			private const PersuasionDifficulty Difficulty = PersuasionDifficulty.MediumHard;
		}

		public class SmugglersIssueTypeDefiner : SaveableTypeDefiner
		{
			public SmugglersIssueTypeDefiner()
				: base(585960)
			{
			}

			protected override void DefineClassTypes()
			{
				base.AddClassDefinition(typeof(SmugglersIssueBehavior.SmugglersIssue), 1, null);
				base.AddClassDefinition(typeof(SmugglersIssueBehavior.SmugglersIssueQuest), 2, null);
			}
		}
	}
}
