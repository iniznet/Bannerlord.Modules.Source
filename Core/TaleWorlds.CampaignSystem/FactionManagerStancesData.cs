using System;
using System.Collections.Generic;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.CampaignSystem
{
	internal class FactionManagerStancesData
	{
		internal static void AutoGeneratedStaticCollectObjectsFactionManagerStancesData(object o, List<object> collectedObjects)
		{
			((FactionManagerStancesData)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		protected virtual void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			collectedObjects.Add(this._stances);
		}

		internal static object AutoGeneratedGetMemberValue_stances(object o)
		{
			return ((FactionManagerStancesData)o)._stances;
		}

		public Dictionary<ValueTuple<IFaction, IFaction>, StanceLink>.ValueCollection GetStanceLinks()
		{
			return this._stances.Values;
		}

		internal StanceLink GetStance(IFaction faction1, IFaction faction2)
		{
			ValueTuple<IFaction, IFaction> key = this.GetKey(faction1, faction2);
			StanceLink stanceLink;
			this._stances.TryGetValue(key, out stanceLink);
			return stanceLink;
		}

		public void AddStance(StanceLink stance)
		{
			ValueTuple<IFaction, IFaction> key = this.GetKey(stance);
			if (this._stances.ContainsKey(key))
			{
				this._stances[key] = stance;
				return;
			}
			this._stances.Add(key, stance);
		}

		public void RemoveStance(StanceLink stance)
		{
			ValueTuple<IFaction, IFaction> key = this.GetKey(stance);
			if (this._stances.ContainsKey(key))
			{
				this._stances.Remove(key);
			}
		}

		private ValueTuple<IFaction, IFaction> GetKey(IFaction faction1, IFaction faction2)
		{
			if (faction1.Id < faction2.Id)
			{
				return new ValueTuple<IFaction, IFaction>(faction1, faction2);
			}
			return new ValueTuple<IFaction, IFaction>(faction2, faction1);
		}

		private ValueTuple<IFaction, IFaction> GetKey(StanceLink stance)
		{
			return this.GetKey(stance.Faction1, stance.Faction2);
		}

		[SaveableField(10)]
		private Dictionary<ValueTuple<IFaction, IFaction>, StanceLink> _stances = new Dictionary<ValueTuple<IFaction, IFaction>, StanceLink>();
	}
}
