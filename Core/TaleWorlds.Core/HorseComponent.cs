using System;
using System.Collections;
using System.Collections.Generic;
using System.Xml;
using TaleWorlds.Library;
using TaleWorlds.Localization;
using TaleWorlds.ObjectSystem;

namespace TaleWorlds.Core
{
	// Token: 0x0200002C RID: 44
	public class HorseComponent : ItemComponent
	{
		// Token: 0x060002E0 RID: 736 RVA: 0x0000C509 File Offset: 0x0000A709
		internal static void AutoGeneratedStaticCollectObjectsHorseComponent(object o, List<object> collectedObjects)
		{
			((HorseComponent)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		// Token: 0x060002E1 RID: 737 RVA: 0x0000C517 File Offset: 0x0000A717
		protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			base.AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		// Token: 0x170000E1 RID: 225
		// (get) Token: 0x060002E2 RID: 738 RVA: 0x0000C520 File Offset: 0x0000A720
		// (set) Token: 0x060002E3 RID: 739 RVA: 0x0000C528 File Offset: 0x0000A728
		public Monster Monster { get; private set; }

		// Token: 0x170000E2 RID: 226
		// (get) Token: 0x060002E4 RID: 740 RVA: 0x0000C531 File Offset: 0x0000A731
		// (set) Token: 0x060002E5 RID: 741 RVA: 0x0000C539 File Offset: 0x0000A739
		public int Maneuver { get; private set; }

		// Token: 0x170000E3 RID: 227
		// (get) Token: 0x060002E6 RID: 742 RVA: 0x0000C542 File Offset: 0x0000A742
		// (set) Token: 0x060002E7 RID: 743 RVA: 0x0000C54A File Offset: 0x0000A74A
		public int ChargeDamage { get; private set; }

		// Token: 0x170000E4 RID: 228
		// (get) Token: 0x060002E8 RID: 744 RVA: 0x0000C553 File Offset: 0x0000A753
		// (set) Token: 0x060002E9 RID: 745 RVA: 0x0000C55B File Offset: 0x0000A75B
		public int Speed { get; private set; }

		// Token: 0x170000E5 RID: 229
		// (get) Token: 0x060002EA RID: 746 RVA: 0x0000C564 File Offset: 0x0000A764
		// (set) Token: 0x060002EB RID: 747 RVA: 0x0000C56C File Offset: 0x0000A76C
		public int BodyLength { get; private set; }

		// Token: 0x170000E6 RID: 230
		// (get) Token: 0x060002EC RID: 748 RVA: 0x0000C575 File Offset: 0x0000A775
		public int HitPoints
		{
			get
			{
				return this.Monster.HitPoints;
			}
		}

		// Token: 0x170000E7 RID: 231
		// (get) Token: 0x060002ED RID: 749 RVA: 0x0000C582 File Offset: 0x0000A782
		// (set) Token: 0x060002EE RID: 750 RVA: 0x0000C58A File Offset: 0x0000A78A
		public int HitPointBonus { get; private set; }

		// Token: 0x170000E8 RID: 232
		// (get) Token: 0x060002EF RID: 751 RVA: 0x0000C593 File Offset: 0x0000A793
		// (set) Token: 0x060002F0 RID: 752 RVA: 0x0000C59B File Offset: 0x0000A79B
		public bool IsRideable { get; private set; }

		// Token: 0x170000E9 RID: 233
		// (get) Token: 0x060002F1 RID: 753 RVA: 0x0000C5A4 File Offset: 0x0000A7A4
		// (set) Token: 0x060002F2 RID: 754 RVA: 0x0000C5AC File Offset: 0x0000A7AC
		public bool IsPackAnimal { get; private set; }

		// Token: 0x170000EA RID: 234
		// (get) Token: 0x060002F3 RID: 755 RVA: 0x0000C5B5 File Offset: 0x0000A7B5
		public bool IsMount
		{
			get
			{
				return this.IsRideable && !this.IsPackAnimal;
			}
		}

		// Token: 0x170000EB RID: 235
		// (get) Token: 0x060002F4 RID: 756 RVA: 0x0000C5CA File Offset: 0x0000A7CA
		public bool IsLiveStock
		{
			get
			{
				return !this.IsRideable && !this.IsPackAnimal;
			}
		}

		// Token: 0x170000EC RID: 236
		// (get) Token: 0x060002F5 RID: 757 RVA: 0x0000C5DF File Offset: 0x0000A7DF
		public MBReadOnlyList<HorseComponent.MaterialProperty> HorseMaterialNames
		{
			get
			{
				return this._monsterMaterialNames;
			}
		}

		// Token: 0x170000ED RID: 237
		// (get) Token: 0x060002F6 RID: 758 RVA: 0x0000C5E7 File Offset: 0x0000A7E7
		public int MeatCount
		{
			get
			{
				if (this.IsRideable)
				{
					return 3;
				}
				if (this.Speed > 20)
				{
					return 6;
				}
				if (this.Speed <= 11)
				{
					return 1;
				}
				return 2;
			}
		}

		// Token: 0x170000EE RID: 238
		// (get) Token: 0x060002F7 RID: 759 RVA: 0x0000C60C File Offset: 0x0000A80C
		public int HideCount
		{
			get
			{
				if (this.IsRideable)
				{
					return 0;
				}
				if (this.Speed <= 20)
				{
					return 1;
				}
				return 2;
			}
		}

		// Token: 0x170000EF RID: 239
		// (get) Token: 0x060002F8 RID: 760 RVA: 0x0000C625 File Offset: 0x0000A825
		// (set) Token: 0x060002F9 RID: 761 RVA: 0x0000C62D File Offset: 0x0000A82D
		public SkeletonScale SkeletonScale { get; private set; }

		// Token: 0x060002FA RID: 762 RVA: 0x0000C638 File Offset: 0x0000A838
		public HorseComponent()
		{
			this.Maneuver = 0;
			this.ChargeDamage = 0;
			this.Speed = 0;
			this.BodyLength = 0;
			this.HitPointBonus = 0;
			this.ModifiedName = null;
			this._monsterMaterialNames = new MBList<HorseComponent.MaterialProperty>();
			this.AdditionalMeshesNameList = new List<KeyValuePair<string, bool>>();
			this.SkeletonScale = null;
		}

		// Token: 0x060002FB RID: 763 RVA: 0x0000C692 File Offset: 0x0000A892
		public override ItemComponent GetCopy()
		{
			return new HorseComponent
			{
				Maneuver = this.Maneuver,
				ChargeDamage = this.ChargeDamage,
				Speed = this.Speed,
				BodyLength = this.BodyLength
			};
		}

		// Token: 0x060002FC RID: 764 RVA: 0x0000C6CC File Offset: 0x0000A8CC
		public override void Deserialize(MBObjectManager objectManager, XmlNode node)
		{
			base.Deserialize(objectManager, node);
			this.Maneuver = XmlHelper.ReadInt(node, "maneuver");
			this.ChargeDamage = XmlHelper.ReadInt(node, "charge_damage");
			this.Speed = XmlHelper.ReadInt(node, "speed");
			this.BodyLength = XmlHelper.ReadInt(node, "body_length");
			this.IsRideable = XmlHelper.ReadBool(node, "is_mountable");
			this.IsPackAnimal = XmlHelper.ReadBool(node, "is_pack_animal");
			this.Monster = (Monster)objectManager.ReadObjectReferenceFromXml("monster", typeof(Monster), node);
			this.HitPointBonus = XmlHelper.ReadInt(node, "extra_health");
			XmlAttribute xmlAttribute = node.Attributes["skeleton_scale"];
			string text = ((xmlAttribute != null) ? xmlAttribute.Value : null);
			if (text != null)
			{
				this.SkeletonScale = Game.Current.ObjectManager.GetObject<SkeletonScale>(text);
			}
			foreach (object obj in node.ChildNodes)
			{
				XmlNode xmlNode = (XmlNode)obj;
				if (xmlNode.Name == "Materials")
				{
					using (IEnumerator enumerator2 = xmlNode.ChildNodes.GetEnumerator())
					{
						while (enumerator2.MoveNext())
						{
							object obj2 = enumerator2.Current;
							XmlNode xmlNode2 = (XmlNode)obj2;
							if (xmlNode2.Name == "Material")
							{
								string value = xmlNode2.Attributes["name"].Value;
								this._monsterMaterialNames.Add(new HorseComponent.MaterialProperty(value));
								foreach (object obj3 in xmlNode2.ChildNodes)
								{
									XmlNode xmlNode3 = (XmlNode)obj3;
									if (xmlNode3.Name == "MeshMultipliers")
									{
										foreach (object obj4 in xmlNode3.ChildNodes)
										{
											XmlNode xmlNode4 = (XmlNode)obj4;
											if (xmlNode4.Name == "MeshMultiplier")
											{
												uint num = ((xmlNode4.Attributes["mesh_multiplier"] != null) ? Convert.ToUInt32(xmlNode4.Attributes["mesh_multiplier"].Value, 16) : 0U);
												float num2 = ((xmlNode4.Attributes["percentage"] != null) ? ((float)Convert.ToDouble(xmlNode4.Attributes["percentage"].Value)) : 0f);
												this._monsterMaterialNames[this._monsterMaterialNames.Count - 1].MeshMultiplier.Add(new Tuple<uint, float>(num, num2));
											}
										}
									}
								}
								this._monsterMaterialNames[this._monsterMaterialNames.Count - 1].MeshMultiplier.Sort((Tuple<uint, float> x, Tuple<uint, float> y) => x.Item2.CompareTo(y.Item2));
							}
						}
						continue;
					}
				}
				if (xmlNode.Name == "AdditionalMeshes")
				{
					foreach (object obj5 in xmlNode.ChildNodes)
					{
						XmlNode xmlNode5 = (XmlNode)obj5;
						if (xmlNode5.Name == "Mesh" && xmlNode5.Attributes["name"] != null)
						{
							bool flag = false;
							if (xmlNode5.Attributes["affected_by_cover"] != null)
							{
								flag = bool.TryParse(xmlNode5.Attributes["affected_by_cover"].InnerText, out flag);
							}
							this.AdditionalMeshesNameList.Add(new KeyValuePair<string, bool>(xmlNode5.Attributes["name"].InnerText, flag));
						}
					}
				}
			}
		}

		// Token: 0x040001BB RID: 443
		public TextObject ModifiedName;

		// Token: 0x040001BC RID: 444
		public List<KeyValuePair<string, bool>> AdditionalMeshesNameList;

		// Token: 0x040001BF RID: 447
		private readonly MBList<HorseComponent.MaterialProperty> _monsterMaterialNames;

		// Token: 0x020000E2 RID: 226
		public struct MaterialProperty
		{
			// Token: 0x060009E2 RID: 2530 RVA: 0x00020507 File Offset: 0x0001E707
			public MaterialProperty(string name)
			{
				this.Name = name;
				this.MeshMultiplier = new List<Tuple<uint, float>>();
			}

			// Token: 0x17000342 RID: 834
			// (get) Token: 0x060009E3 RID: 2531 RVA: 0x0002051B File Offset: 0x0001E71B
			// (set) Token: 0x060009E4 RID: 2532 RVA: 0x00020523 File Offset: 0x0001E723
			public string Name { get; private set; }

			// Token: 0x04000641 RID: 1601
			public List<Tuple<uint, float>> MeshMultiplier;
		}
	}
}
