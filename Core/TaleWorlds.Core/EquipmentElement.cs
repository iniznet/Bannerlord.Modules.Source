using System;
using System.Collections.Generic;
using TaleWorlds.Library;
using TaleWorlds.Localization;
using TaleWorlds.ObjectSystem;
using TaleWorlds.SaveSystem;

namespace TaleWorlds.Core
{
	// Token: 0x02000041 RID: 65
	public struct EquipmentElement : ISerializableObject
	{
		// Token: 0x06000511 RID: 1297 RVA: 0x00012F4C File Offset: 0x0001114C
		public static void AutoGeneratedStaticCollectObjectsEquipmentElement(object o, List<object> collectedObjects)
		{
			((EquipmentElement)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
		}

		// Token: 0x06000512 RID: 1298 RVA: 0x00012F68 File Offset: 0x00011168
		private void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
		{
			collectedObjects.Add(this.Item);
			collectedObjects.Add(this.ItemModifier);
		}

		// Token: 0x06000513 RID: 1299 RVA: 0x00012F84 File Offset: 0x00011184
		internal static object AutoGeneratedGetMemberValueItem(object o)
		{
			return ((EquipmentElement)o).Item;
		}

		// Token: 0x06000514 RID: 1300 RVA: 0x00012FA0 File Offset: 0x000111A0
		internal static object AutoGeneratedGetMemberValueItemModifier(object o)
		{
			return ((EquipmentElement)o).ItemModifier;
		}

		// Token: 0x06000515 RID: 1301 RVA: 0x00012FBC File Offset: 0x000111BC
		internal static object AutoGeneratedGetMemberValueIsQuestItem(object o)
		{
			return ((EquipmentElement)o).IsQuestItem;
		}

		// Token: 0x170001A9 RID: 425
		// (get) Token: 0x06000516 RID: 1302 RVA: 0x00012FDC File Offset: 0x000111DC
		// (set) Token: 0x06000517 RID: 1303 RVA: 0x00012FE4 File Offset: 0x000111E4
		[SaveableProperty(1)]
		public ItemObject Item { get; private set; }

		// Token: 0x170001AA RID: 426
		// (get) Token: 0x06000518 RID: 1304 RVA: 0x00012FED File Offset: 0x000111ED
		// (set) Token: 0x06000519 RID: 1305 RVA: 0x00012FF5 File Offset: 0x000111F5
		[SaveableProperty(2)]
		public ItemModifier ItemModifier { get; private set; }

		// Token: 0x170001AB RID: 427
		// (get) Token: 0x0600051A RID: 1306 RVA: 0x00012FFE File Offset: 0x000111FE
		// (set) Token: 0x0600051B RID: 1307 RVA: 0x00013006 File Offset: 0x00011206
		[SaveableProperty(3)]
		public bool IsQuestItem { get; private set; }

		// Token: 0x170001AC RID: 428
		// (get) Token: 0x0600051C RID: 1308 RVA: 0x0001300F File Offset: 0x0001120F
		public bool IsEmpty
		{
			get
			{
				return this.Item == null;
			}
		}

		// Token: 0x170001AD RID: 429
		// (get) Token: 0x0600051D RID: 1309 RVA: 0x0001301A File Offset: 0x0001121A
		public bool IsVisualEmpty
		{
			get
			{
				return this.IsEmpty && this.CosmeticItem == null;
			}
		}

		// Token: 0x170001AE RID: 430
		// (get) Token: 0x0600051E RID: 1310 RVA: 0x00013030 File Offset: 0x00011230
		public int ItemValue
		{
			get
			{
				int num = 0;
				if (this.Item != null)
				{
					num = this.Item.Value;
					if (this.ItemModifier != null)
					{
						num = MathF.Round((float)num * this.ItemModifier.PriceMultiplier);
					}
				}
				return num;
			}
		}

		// Token: 0x170001AF RID: 431
		// (get) Token: 0x0600051F RID: 1311 RVA: 0x00013070 File Offset: 0x00011270
		public float Weight
		{
			get
			{
				float weight = this.Item.Weight;
				if (weight <= 0f)
				{
					return 0f;
				}
				return weight;
			}
		}

		// Token: 0x06000520 RID: 1312 RVA: 0x00013098 File Offset: 0x00011298
		public EquipmentElement(ItemObject item, ItemModifier itemModifier = null, ItemObject cosmeticItem = null, bool isQuestItem = false)
		{
			this.Item = item;
			this.ItemModifier = itemModifier;
			this.CosmeticItem = cosmeticItem;
			this.IsQuestItem = isQuestItem;
		}

		// Token: 0x06000521 RID: 1313 RVA: 0x000130B7 File Offset: 0x000112B7
		public EquipmentElement(EquipmentElement other)
		{
			this = new EquipmentElement(other.Item, other.ItemModifier, other.CosmeticItem, false);
		}

		// Token: 0x06000522 RID: 1314 RVA: 0x000130D4 File Offset: 0x000112D4
		public void SetModifier(ItemModifier itemModifier)
		{
			this.ItemModifier = itemModifier;
		}

		// Token: 0x06000523 RID: 1315 RVA: 0x000130DD File Offset: 0x000112DD
		public void Clear()
		{
			this.Item = null;
			this.ItemModifier = null;
		}

		// Token: 0x06000524 RID: 1316 RVA: 0x000130F0 File Offset: 0x000112F0
		public override int GetHashCode()
		{
			int num = 0;
			if (this.Item != null)
			{
				num += this.Item.GetHashCode();
			}
			if (this.ItemModifier != null)
			{
				num += this.ItemModifier.GetHashCode() * 317;
			}
			return num;
		}

		// Token: 0x06000525 RID: 1317 RVA: 0x00013132 File Offset: 0x00011332
		public override string ToString()
		{
			return this.Item.ToString() ?? "";
		}

		// Token: 0x06000526 RID: 1318 RVA: 0x00013148 File Offset: 0x00011348
		public int GetModifiedHeadArmor()
		{
			int num = 0;
			if (this.Item.HasArmorComponent)
			{
				num = this.Item.ArmorComponent.HeadArmor;
			}
			if (num > 0 && this.ItemModifier != null)
			{
				num = this.ItemModifier.ModifyArmor(num);
			}
			if (num <= 0)
			{
				return 0;
			}
			return num;
		}

		// Token: 0x06000527 RID: 1319 RVA: 0x00013198 File Offset: 0x00011398
		public int GetModifiedBodyArmor()
		{
			int num = 0;
			if (this.Item.HasArmorComponent)
			{
				ArmorComponent armorComponent = this.Item.ArmorComponent;
				num = ((this.Item.ItemType != ItemObject.ItemTypeEnum.HorseHarness) ? armorComponent.BodyArmor : 0);
			}
			else if (this.Item.WeaponComponent != null)
			{
				num = this.Item.WeaponComponent.PrimaryWeapon.BodyArmor;
			}
			if (num > 0 && this.ItemModifier != null)
			{
				num = this.ItemModifier.ModifyArmor(num);
			}
			if (num <= 0)
			{
				return 0;
			}
			return num;
		}

		// Token: 0x06000528 RID: 1320 RVA: 0x00013220 File Offset: 0x00011420
		public int GetModifiedMountBodyArmor()
		{
			int num = 0;
			if (this.Item.HasArmorComponent)
			{
				ArmorComponent armorComponent = this.Item.ArmorComponent;
				num = ((this.Item.ItemType == ItemObject.ItemTypeEnum.HorseHarness) ? armorComponent.BodyArmor : 0);
			}
			else if (this.Item.WeaponComponent != null)
			{
				num = this.Item.WeaponComponent.PrimaryWeapon.BodyArmor;
			}
			if (num > 0 && this.ItemModifier != null)
			{
				num = this.ItemModifier.ModifyArmor(num);
			}
			if (num <= 0)
			{
				return 0;
			}
			return num;
		}

		// Token: 0x06000529 RID: 1321 RVA: 0x000132A8 File Offset: 0x000114A8
		public int GetModifiedLegArmor()
		{
			int num = 0;
			if (this.Item.HasArmorComponent)
			{
				num = this.Item.ArmorComponent.LegArmor;
			}
			if (num > 0 && this.ItemModifier != null)
			{
				num = this.ItemModifier.ModifyArmor(num);
			}
			if (num <= 0)
			{
				return 0;
			}
			return num;
		}

		// Token: 0x0600052A RID: 1322 RVA: 0x000132F8 File Offset: 0x000114F8
		public int GetModifiedArmArmor()
		{
			int num = 0;
			if (this.Item.HasArmorComponent)
			{
				num = this.Item.ArmorComponent.ArmArmor;
			}
			if (num > 0 && this.ItemModifier != null)
			{
				num = this.ItemModifier.ModifyArmor(num);
			}
			if (num <= 0)
			{
				return 0;
			}
			return num;
		}

		// Token: 0x0600052B RID: 1323 RVA: 0x00013345 File Offset: 0x00011545
		public short GetModifiedMaximumHitPointsForUsage(int usageIndex)
		{
			return this.Item.GetWeaponWithUsageIndex(usageIndex).GetModifiedMaximumHitPoints(this.ItemModifier);
		}

		// Token: 0x0600052C RID: 1324 RVA: 0x00013360 File Offset: 0x00011560
		public TextObject GetModifiedItemName()
		{
			if (this.ItemModifier == null)
			{
				return this.Item.Name;
			}
			HorseComponent horseComponent = this.Item.HorseComponent;
			TextObject textObject;
			if (!TextObject.IsNullOrEmpty((horseComponent != null) ? horseComponent.ModifiedName : null) && this.ItemModifier == null)
			{
				textObject = horseComponent.ModifiedName;
			}
			else
			{
				textObject = this.ItemModifier.Name;
				textObject.SetTextVariable("ITEMNAME", this.Item.Name);
			}
			return textObject;
		}

		// Token: 0x0600052D RID: 1325 RVA: 0x000133D5 File Offset: 0x000115D5
		public int GetModifiedThrustDamageForUsage(int usageIndex)
		{
			return this.Item.GetWeaponWithUsageIndex(usageIndex).GetModifiedThrustDamage(this.ItemModifier);
		}

		// Token: 0x0600052E RID: 1326 RVA: 0x000133EE File Offset: 0x000115EE
		public int GetModifiedSwingDamageForUsage(int usageIndex)
		{
			return this.Item.GetWeaponWithUsageIndex(usageIndex).GetModifiedSwingDamage(this.ItemModifier);
		}

		// Token: 0x0600052F RID: 1327 RVA: 0x00013407 File Offset: 0x00011607
		public int GetModifiedMissileDamageForUsage(int usageIndex)
		{
			return this.Item.GetWeaponWithUsageIndex(usageIndex).GetModifiedMissileDamage(this.ItemModifier);
		}

		// Token: 0x06000530 RID: 1328 RVA: 0x00013420 File Offset: 0x00011620
		public int GetModifiedThrustSpeedForUsage(int usageIndex)
		{
			return this.Item.GetWeaponWithUsageIndex(usageIndex).GetModifiedThrustSpeed(this.ItemModifier);
		}

		// Token: 0x06000531 RID: 1329 RVA: 0x00013439 File Offset: 0x00011639
		public int GetModifiedSwingSpeedForUsage(int usageIndex)
		{
			return this.Item.GetWeaponWithUsageIndex(usageIndex).GetModifiedSwingSpeed(this.ItemModifier);
		}

		// Token: 0x06000532 RID: 1330 RVA: 0x00013452 File Offset: 0x00011652
		public int GetModifiedMissileSpeedForUsage(int usageIndex)
		{
			return this.Item.GetWeaponWithUsageIndex(usageIndex).GetModifiedMissileSpeed(this.ItemModifier);
		}

		// Token: 0x06000533 RID: 1331 RVA: 0x0001346B File Offset: 0x0001166B
		public int GetModifiedHandlingForUsage(int usageIndex)
		{
			return this.Item.GetWeaponWithUsageIndex(usageIndex).GetModifiedHandling(this.ItemModifier);
		}

		// Token: 0x06000534 RID: 1332 RVA: 0x00013484 File Offset: 0x00011684
		public short GetModifiedStackCountForUsage(int usageIndex)
		{
			return this.Item.GetWeaponWithUsageIndex(usageIndex).GetModifiedStackCount(this.ItemModifier);
		}

		// Token: 0x06000535 RID: 1333 RVA: 0x000134A0 File Offset: 0x000116A0
		public int GetBaseValue()
		{
			int num = this.Item.Value;
			if (this.ItemModifier != null)
			{
				num = (int)((float)num * this.ItemModifier.PriceMultiplier);
			}
			return num;
		}

		// Token: 0x06000536 RID: 1334 RVA: 0x000134D2 File Offset: 0x000116D2
		public bool IsEqualTo(EquipmentElement other)
		{
			return this.Item == other.Item && this.ItemModifier == other.ItemModifier;
		}

		// Token: 0x06000537 RID: 1335 RVA: 0x000134F4 File Offset: 0x000116F4
		public override bool Equals(object obj)
		{
			if (obj is ItemRosterElement)
			{
				ItemRosterElement itemRosterElement = (ItemRosterElement)obj;
				return this.Equals(itemRosterElement);
			}
			return false;
		}

		// Token: 0x06000538 RID: 1336 RVA: 0x00013520 File Offset: 0x00011720
		public bool Equals(ItemRosterElement other)
		{
			return this.Item == other.EquipmentElement.Item && this.ItemModifier == other.EquipmentElement.ItemModifier;
		}

		// Token: 0x06000539 RID: 1337 RVA: 0x00013560 File Offset: 0x00011760
		public float GetEquipmentElementWeight()
		{
			if (this.Item == null)
			{
				return 0f;
			}
			if (this.Item.PrimaryWeapon == null || !this.Item.PrimaryWeapon.IsConsumable)
			{
				return this.Weight;
			}
			return this.Weight * (float)this.GetModifiedStackCountForUsage(0);
		}

		// Token: 0x0600053A RID: 1338 RVA: 0x000135B0 File Offset: 0x000117B0
		public bool IsInvalid()
		{
			return this.Item == EquipmentElement.Invalid.Item && this.ItemModifier == EquipmentElement.Invalid.ItemModifier;
		}

		// Token: 0x0600053B RID: 1339 RVA: 0x000135EC File Offset: 0x000117EC
		public int GetModifiedMountManeuver(in EquipmentElement harness)
		{
			if (this.Item == null)
			{
				return 0;
			}
			HorseComponent horseComponent = this.Item.HorseComponent;
			EquipmentElement equipmentElement = harness;
			ItemObject item = equipmentElement.Item;
			ArmorComponent armorComponent = ((item != null) ? item.ArmorComponent : null);
			int num = horseComponent.Maneuver + ((armorComponent != null) ? armorComponent.ManeuverBonus : 0);
			if (this.ItemModifier != null)
			{
				num = this.ItemModifier.ModifyMountManeuver(num);
			}
			equipmentElement = harness;
			if (!equipmentElement.IsEmpty)
			{
				equipmentElement = harness;
				if (equipmentElement.ItemModifier != null)
				{
					equipmentElement = harness;
					num = equipmentElement.ItemModifier.ModifyMountManeuver(num);
				}
			}
			return num;
		}

		// Token: 0x0600053C RID: 1340 RVA: 0x00013688 File Offset: 0x00011888
		public int GetModifiedMountSpeed(in EquipmentElement harness)
		{
			if (this.Item == null)
			{
				return 0;
			}
			HorseComponent horseComponent = this.Item.HorseComponent;
			EquipmentElement equipmentElement = harness;
			ItemObject item = equipmentElement.Item;
			ArmorComponent armorComponent = ((item != null) ? item.ArmorComponent : null);
			int num = horseComponent.Speed + ((armorComponent != null) ? armorComponent.SpeedBonus : 0);
			if (this.ItemModifier != null)
			{
				num = this.ItemModifier.ModifyMountSpeed(num);
			}
			equipmentElement = harness;
			if (!equipmentElement.IsEmpty)
			{
				equipmentElement = harness;
				if (equipmentElement.ItemModifier != null)
				{
					equipmentElement = harness;
					num = equipmentElement.ItemModifier.ModifyMountSpeed(num);
				}
			}
			return num;
		}

		// Token: 0x0600053D RID: 1341 RVA: 0x00013724 File Offset: 0x00011924
		public int GetModifiedMountCharge(in EquipmentElement harness)
		{
			if (this.Item == null)
			{
				return 0;
			}
			HorseComponent horseComponent = this.Item.HorseComponent;
			EquipmentElement equipmentElement = harness;
			ItemObject item = equipmentElement.Item;
			ArmorComponent armorComponent = ((item != null) ? item.ArmorComponent : null);
			int num = horseComponent.ChargeDamage + ((armorComponent != null) ? armorComponent.ChargeBonus : 0);
			if (this.ItemModifier != null)
			{
				num = this.ItemModifier.ModifyMountCharge(num);
			}
			equipmentElement = harness;
			if (!equipmentElement.IsEmpty)
			{
				equipmentElement = harness;
				if (equipmentElement.ItemModifier != null)
				{
					equipmentElement = harness;
					num = equipmentElement.ItemModifier.ModifyMountCharge(num);
				}
			}
			return num;
		}

		// Token: 0x0600053E RID: 1342 RVA: 0x000137C0 File Offset: 0x000119C0
		public int GetModifiedMountHitPoints()
		{
			if (this.Item == null)
			{
				return 0;
			}
			HorseComponent horseComponent = this.Item.HorseComponent;
			int num = horseComponent.HitPoints + horseComponent.HitPointBonus;
			if (this.ItemModifier != null)
			{
				num = this.ItemModifier.ModifyMountHitPoints(num);
			}
			if (num <= 0)
			{
				return 0;
			}
			return num;
		}

		// Token: 0x0600053F RID: 1343 RVA: 0x00013810 File Offset: 0x00011A10
		void ISerializableObject.DeserializeFrom(IReader reader)
		{
			string text = reader.ReadString();
			this.ItemModifier = null;
			if (text != "")
			{
				this.ItemModifier = Game.Current.ObjectManager.GetObject<ItemModifier>(text);
			}
			MBGUID mbguid = new MBGUID(reader.ReadUInt());
			this.Item = MBObjectManager.Instance.GetObject(mbguid) as ItemObject;
		}

		// Token: 0x06000540 RID: 1344 RVA: 0x00013874 File Offset: 0x00011A74
		void ISerializableObject.SerializeTo(IWriter writer)
		{
			writer.WriteString((this.ItemModifier != null) ? this.ItemModifier.StringId : "");
			ItemObject item = this.Item;
			writer.WriteUInt((item != null) ? item.Id.InternalValue : 0U);
		}

		// Token: 0x04000267 RID: 615
		public static readonly EquipmentElement Invalid = new EquipmentElement(null, null, null, false);

		// Token: 0x0400026B RID: 619
		public ItemObject CosmeticItem;
	}
}
